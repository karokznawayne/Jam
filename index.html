<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Jam by Kz</title>
<style>
:root{--bg:#0a0a0e;--bg2:#0f0f17;--bg3:#141420;--bg4:#1a1a28;--surf:#1e1e2e;--surf2:#252538;--border:#2a2a42;--border2:#363656;--acc:#7c6fff;--acc2:#00e5b4;--acc3:#ff6b9d;--gold:#f7c948;--text:#e2e2f0;--text2:#9090b0;--text3:#50506a;--html:#f97316;--css:#3b9eff;--js:#f7c948;--safe-t:env(safe-area-inset-top,0px);--safe-b:env(safe-area-inset-bottom,0px);}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent;}
html,body{height:100%;overflow:hidden;}
body{font-family:'Segoe UI',system-ui,sans-serif;background:var(--bg);color:var(--text);}
::-webkit-scrollbar{width:4px;height:4px;}::-webkit-scrollbar-track{background:transparent;}::-webkit-scrollbar-thumb{background:var(--border2);border-radius:4px;}
::placeholder{color:var(--text3);}input,select,textarea,button{font-family:inherit;}option{background:var(--bg3);}
.hidden{display:none!important;}
.fi,.fsel,.fta{width:100%;padding:10px 12px;background:var(--bg);border:1px solid var(--border);border-radius:8px;color:var(--text);font-family:'Courier New',monospace;font-size:12px;transition:border-color .15s;}
.fi:focus,.fsel:focus,.fta:focus{outline:none;border-color:var(--acc);box-shadow:0 0 0 3px rgba(124,111,255,.15);}
.fta{resize:vertical;min-height:85px;line-height:1.5;}
.fsel{appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='7'%3E%3Cpath fill='%2350506a' d='M5 7L0 0h10z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 10px center;padding-right:28px;}
.fg{margin-bottom:16px;}.flabel{display:flex;align-items:center;justify-content:space-between;margin-bottom:6px;font-size:10px;font-weight:800;color:var(--text2);text-transform:uppercase;letter-spacing:1px;}
.fhint{font-size:9px;font-family:monospace;color:var(--text3);margin-top:4px;}.frow{display:flex;gap:10px;}.frow .fg{flex:1;}.json-st{font-size:9px;font-family:monospace;margin-top:4px;}
.toggle-row{display:flex;align-items:center;gap:10px;padding:10px 12px;background:var(--bg);border:1px solid var(--border);border-radius:8px;cursor:pointer;transition:border-color .15s;margin-bottom:8px;}
.toggle-row.checked{border-color:var(--acc);}
.toggle-row input[type=checkbox]{display:none;}
.tknob{width:34px;height:18px;background:var(--surf);border-radius:20px;position:relative;transition:background .2s;flex-shrink:0;border:1px solid var(--border2);}
.tknob::after{content:'';position:absolute;width:12px;height:12px;border-radius:50%;background:var(--text3);top:2px;left:2px;transition:all .2s;}
.toggle-row.checked .tknob{background:var(--acc);border-color:var(--acc);}
.toggle-row.checked .tknob::after{left:18px;background:#fff;}
.tlbl{font-size:12px;font-weight:600;}.tsub{font-size:9px;color:var(--text3);font-family:monospace;margin-top:1px;}
.mbadge{font-family:monospace;font-size:9px;font-weight:800;padding:2px 5px;border-radius:3px;letter-spacing:.3px;flex-shrink:0;}
.m-GET{background:rgba(0,229,180,.12);color:var(--acc2);}.m-POST{background:rgba(124,111,255,.12);color:var(--acc);}.m-PUT{background:rgba(247,201,72,.12);color:var(--gold);}.m-PATCH{background:rgba(247,201,72,.08);color:var(--gold);}.m-DELETE{background:rgba(255,107,157,.12);color:var(--acc3);}
.sep{border:none;border-top:1px solid var(--border);margin:14px 0;}
.btn-sm{padding:4px 9px;border:1px solid var(--border);border-radius:5px;background:transparent;color:var(--acc);font-size:10px;font-weight:700;cursor:pointer;transition:all .15s;}
.btn-sm:hover{border-color:var(--acc);background:rgba(124,111,255,.1);}
.toast{position:fixed;bottom:calc(var(--safe-b) + 90px);left:50%;transform:translateX(-50%) translateY(20px);background:var(--surf2);border:1px solid var(--border2);border-radius:14px;padding:12px 20px;font-size:13px;font-weight:600;color:var(--text);display:flex;align-items:center;gap:8px;box-shadow:0 8px 40px rgba(0,0,0,.6);opacity:0;transition:all .3s cubic-bezier(.34,1.56,.64,1);z-index:9999;white-space:nowrap;pointer-events:none;}
.toast.show{transform:translateX(-50%) translateY(0);opacity:1;}
@media(min-width:769px){.toast{bottom:24px;left:auto;right:24px;transform:translateY(20px);}.toast.show{transform:translateY(0);}}
.drawer-overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:200;opacity:0;pointer-events:none;transition:opacity .3s;}
.drawer-overlay.open{opacity:1;pointer-events:all;}
.drawer{position:fixed;left:0;top:0;bottom:0;width:280px;background:var(--bg2);border-right:1px solid var(--border);z-index:201;transform:translateX(-100%);transition:transform .3s cubic-bezier(.4,0,.2,1);display:flex;flex-direction:column;padding-top:var(--safe-t);}
.drawer.open{transform:translateX(0);}
.drawer-head{display:flex;align-items:center;justify-content:space-between;padding:16px 16px 12px;border-bottom:1px solid var(--border);}
.drawer-title{font-size:13px;font-weight:800;color:var(--text2);letter-spacing:1px;text-transform:uppercase;}
.drawer-close{background:transparent;border:none;color:var(--text3);font-size:18px;cursor:pointer;padding:4px;line-height:1;}
.drawer-new{margin:10px 12px;padding:10px;border:none;border-radius:8px;background:linear-gradient(135deg,var(--acc),#9b6eff);color:#fff;font-size:12px;font-weight:700;cursor:pointer;width:calc(100% - 24px);}
.drawer-list{flex:1;overflow-y:auto;padding:8px;}
.drawer-item{display:flex;align-items:center;gap:8px;padding:10px;border-radius:8px;cursor:pointer;margin-bottom:2px;border:1px solid transparent;transition:all .15s;}
.drawer-item:hover{background:var(--surf);border-color:var(--border);}
.drawer-item.active{background:var(--surf2);border-color:var(--acc);}
.drawer-item-meta{flex:1;min-width:0;}
.drawer-item-name{font-size:12px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.drawer-item-sub{font-size:10px;color:var(--text3);margin-top:2px;font-family:monospace;}
.drawer-item-del{background:transparent;border:none;color:transparent;padding:5px;cursor:pointer;border-radius:4px;font-size:12px;}
.drawer-item:hover .drawer-item-del{color:var(--text3);}
.drawer-empty{padding:20px;text-align:center;color:var(--text3);font-size:11px;font-family:monospace;line-height:1.8;}

/* ‚îÄ‚îÄ PC ‚îÄ‚îÄ */
@media(min-width:769px){
.mobile-only{display:none!important;}
#app{display:flex;flex-direction:column;height:100vh;}
.pc-topbar{display:flex;align-items:center;justify-content:space-between;padding:0 20px;height:52px;background:var(--bg2);border-bottom:1px solid var(--border);flex-shrink:0;}
.logo{display:flex;align-items:center;gap:10px;font-size:17px;font-weight:800;white-space:nowrap;}
.logo-gem{width:30px;height:30px;background:linear-gradient(135deg,var(--acc),var(--acc2));border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:15px;flex-shrink:0;}
.logo-kz{color:var(--acc);}.logo-by{color:var(--text3);font-weight:400;font-size:13px;}
.mode-sw{display:flex;background:var(--surf);border:1px solid var(--border);border-radius:10px;padding:4px;gap:3px;}
.mode-btn{padding:6px 12px;border:none;border-radius:7px;font-size:12px;font-weight:700;background:transparent;color:var(--text3);cursor:pointer;transition:all .2s;display:flex;align-items:center;gap:5px;}
.mode-btn .dot{width:7px;height:7px;border-radius:50%;opacity:.5;transition:opacity .2s;}
.mode-btn.active{background:var(--surf2);color:var(--text);box-shadow:0 2px 8px rgba(0,0,0,.4);}
.mode-btn.active .dot{opacity:1;}
.chip{font-size:10px;font-weight:700;padding:3px 9px;border-radius:20px;letter-spacing:.8px;background:var(--surf);border:1px solid var(--border);color:var(--text3);}
.pc-body{flex:1;overflow:hidden;display:flex;}
.pc-view{display:flex;flex:1;overflow:hidden;}.pc-view.hidden{display:none;}
/* Sidebar */
.pc-sidebar{width:210px;flex-shrink:0;background:var(--bg2);border-right:1px solid var(--border);display:flex;flex-direction:column;}
.sb-hd{padding:14px 12px 10px;border-bottom:1px solid var(--border);}
.sb-lbl{font-size:9px;font-weight:800;letter-spacing:2px;text-transform:uppercase;color:var(--text3);margin-bottom:8px;}
.sb-new{display:flex;align-items:center;justify-content:center;gap:7px;width:100%;padding:9px;border:none;border-radius:8px;background:linear-gradient(135deg,var(--acc),#9b6eff);color:#fff;font-size:12px;font-weight:700;cursor:pointer;transition:all .2s;}
.sb-new:hover{opacity:.85;}
.sb-list{flex:1;overflow-y:auto;padding:8px;}
.sb-item{display:flex;align-items:center;gap:8px;padding:9px 10px;border-radius:8px;cursor:pointer;margin-bottom:2px;border:1px solid transparent;transition:all .15s;}
.sb-item:hover{background:var(--surf);border-color:var(--border);}
.sb-item.active{background:var(--surf2);border-color:var(--acc);}
.sb-item-meta{flex:1;min-width:0;}
.sb-item-name{font-size:12px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.sb-item-sub{font-size:10px;color:var(--text3);margin-top:1px;font-family:monospace;}
.sb-del{background:transparent;border:none;color:transparent;padding:3px 5px;border-radius:4px;font-size:11px;cursor:pointer;}
.sb-item:hover .sb-del{color:var(--text3);}
.sb-del:hover{color:var(--acc3)!important;}
.sb-empty{padding:20px 12px;text-align:center;color:var(--text3);font-size:11px;line-height:1.7;font-family:monospace;}
/* Form Panel */
.pc-form{width:370px;flex-shrink:0;background:var(--bg3);border-right:1px solid var(--border);display:flex;flex-direction:column;overflow:hidden;}
.fp-hd{padding:18px 18px 0;flex-shrink:0;}
.fp-title{font-size:11px;font-weight:800;letter-spacing:2px;text-transform:uppercase;color:var(--text3);}
.tabs-row{display:flex;margin-top:14px;border-bottom:1px solid var(--border);}
.tab-btn{padding:8px 13px;border:none;background:transparent;color:var(--text3);font-size:11px;font-weight:700;cursor:pointer;border-bottom:2px solid transparent;margin-bottom:-1px;transition:all .15s;}
.tab-btn:hover{color:var(--text2);}.tab-btn.active{color:var(--acc);border-bottom-color:var(--acc);}
.form-scroll{flex:1;overflow-y:auto;padding:18px;}
.fp-foot{padding:14px 18px;border-top:1px solid var(--border);display:flex;gap:8px;flex-shrink:0;}
.btn-save{flex:1;padding:10px;background:linear-gradient(135deg,var(--acc),#9b6eff);border:none;border-radius:8px;color:#fff;font-size:13px;font-weight:700;cursor:pointer;transition:all .2s;}
.btn-save:hover{opacity:.9;}
.btn-reset{padding:10px 14px;background:var(--surf);border:1px solid var(--border);border-radius:8px;color:var(--text2);font-size:12px;font-weight:700;cursor:pointer;}
/* Apex Preview */
.apex-prev{flex:1;display:flex;flex-direction:column;overflow:hidden;}
.prev-topbar{display:flex;align-items:center;justify-content:space-between;padding:12px 18px;border-bottom:1px solid var(--border);flex-shrink:0;}
.code-tabs{display:flex;background:var(--surf);border:1px solid var(--border);border-radius:8px;padding:3px;gap:2px;}
.ctab{padding:5px 12px;border:none;border-radius:5px;background:transparent;color:var(--text3);font-size:11px;font-weight:700;cursor:pointer;transition:all .15s;}
.ctab.active{background:var(--bg4);color:var(--text);}
.prev-acts{display:flex;gap:6px;}
.btn-act{display:flex;align-items:center;gap:5px;padding:7px 12px;background:var(--surf);border:1px solid var(--border);border-radius:6px;color:var(--text2);font-size:11px;font-weight:700;cursor:pointer;transition:all .15s;}
.btn-act:hover{border-color:var(--acc);color:var(--acc);}
.stats-bar{display:flex;gap:18px;padding:7px 18px;border-bottom:1px solid var(--border);flex-shrink:0;}
.stat{display:flex;align-items:center;gap:5px;font-size:10px;font-family:monospace;color:var(--text3);}
.sdot{width:5px;height:5px;border-radius:50%;flex-shrink:0;}
.apex-code-area{flex:1;overflow-y:auto;padding:16px;}
.code-block{background:var(--bg2);border:1px solid var(--border);border-radius:10px;overflow:hidden;margin-bottom:16px;}
.cbh{display:flex;align-items:center;justify-content:space-between;padding:10px 14px;background:var(--surf);border-bottom:1px solid var(--border);}
.cbh-l{display:flex;align-items:center;gap:8px;font-size:11px;font-weight:700;color:var(--text2);}
.cbdot{width:7px;height:7px;border-radius:50%;}
.cbc{background:transparent;border:1px solid var(--border);color:var(--text3);padding:3px 9px;border-radius:4px;font-size:10px;font-weight:700;cursor:pointer;}
.cbc:hover{border-color:var(--acc2);color:var(--acc2);}
pre.apex{padding:16px;font-family:'Courier New',monospace;font-size:11.5px;line-height:1.65;overflow-x:auto;margin:0;color:#c8d3f5;}
/* PG */
.pg-wrap{flex:1;display:flex;flex-direction:column;overflow:hidden;}
.pg-topbar{display:flex;align-items:center;padding:8px 16px;border-bottom:1px solid var(--border);flex-shrink:0;background:var(--bg2);gap:10px;}
.pg-ftabs{display:flex;gap:3px;}
.pg-ftab{display:flex;align-items:center;gap:6px;padding:6px 13px;border:1px solid var(--border);border-radius:7px;background:transparent;color:var(--text3);font-size:11px;font-weight:700;cursor:pointer;transition:all .15s;}
.pg-ftab .ftdot{width:7px;height:7px;border-radius:50%;}
.pg-ftab.active{background:var(--surf2);border-color:var(--border2);color:var(--text);}
.pg-ftab.active[data-lang=html]{border-color:var(--html);color:var(--html);}
.pg-ftab.active[data-lang=css]{border-color:var(--css);color:var(--css);}
.pg-ftab.active[data-lang=js]{border-color:var(--js);color:var(--js);}
.pg-acts{display:flex;align-items:center;gap:6px;margin-left:auto;}
.auto-tog{display:flex;align-items:center;gap:6px;font-size:11px;color:var(--text3);cursor:pointer;padding:5px 9px;border:1px solid var(--border);border-radius:6px;}
.auto-tog.on{border-color:var(--acc2);color:var(--acc2);}
.auto-dot{width:6px;height:6px;border-radius:50%;background:var(--text3);}
.auto-tog.on .auto-dot{background:var(--acc2);}
.lay-btn{padding:6px 10px;background:var(--surf);border:1px solid var(--border);border-radius:6px;color:var(--text3);font-size:12px;cursor:pointer;}
.lay-btn.active-lay{border-color:var(--acc);color:var(--acc);}
.btn-run{display:flex;align-items:center;gap:6px;padding:7px 16px;background:linear-gradient(135deg,var(--acc2),#00c49a);border:none;border-radius:7px;color:#000;font-size:12px;font-weight:800;cursor:pointer;}
.btn-run.running{animation:pulse .6s ease infinite alternate;}
@keyframes pulse{from{opacity:1;}to{opacity:.5;}}
.pg-main{flex:1;display:flex;overflow:hidden;}
.ed-pane{display:flex;flex-direction:column;overflow:hidden;border-right:1px solid var(--border);}
.ed-pane.half{width:50%;}.ed-pane.full{width:100%;}.ed-pane.gone{width:0;border:none;}
.ed-wrap{flex:1;display:flex;overflow:hidden;font-family:'Courier New',monospace;font-size:12.5px;background:var(--bg);}
.line-nums{padding:14px 0 14px 14px;background:var(--bg2);color:var(--text3);text-align:right;user-select:none;border-right:1px solid var(--border);overflow:hidden;min-width:46px;line-height:1.65;font-size:12.5px;flex-shrink:0;}
.code-ta{flex:1;padding:14px;background:transparent;border:none;color:var(--text);font-family:'Courier New',monospace;font-size:12.5px;line-height:1.65;resize:none;outline:none;tab-size:2;}
.pv-pane{display:flex;flex-direction:column;overflow:hidden;}
.pv-pane.half{width:50%;}.pv-pane.full{width:100%;}.pv-pane.gone{width:0;}
.pv-hdr{display:flex;align-items:center;justify-content:space-between;padding:8px 14px;border-bottom:1px solid var(--border);flex-shrink:0;background:var(--bg2);}
.pv-title{font-size:11px;font-weight:700;color:var(--text3);display:flex;align-items:center;gap:6px;}
.pv-btn{padding:4px 10px;background:transparent;border:1px solid var(--border);border-radius:5px;color:var(--text3);font-size:10px;font-weight:700;cursor:pointer;}
.pv-wrap{flex:1;background:#fff;position:relative;}.pv-wrap iframe{width:100%;height:100%;border:none;display:block;}
.pv-ind{position:absolute;top:10px;right:10px;font-size:10px;font-weight:700;padding:4px 10px;border-radius:20px;background:rgba(0,229,180,.9);color:#000;opacity:0;transition:opacity .3s;pointer-events:none;z-index:10;}
.pv-ind.show{opacity:1;}
.console-wrap{flex-shrink:0;height:0;overflow:hidden;transition:height .3s;background:var(--bg);border-top:1px solid var(--border);display:flex;flex-direction:column;}
.console-wrap.open{height:155px;}
.con-hdr{display:flex;align-items:center;justify-content:space-between;padding:7px 14px;border-bottom:1px solid var(--border);flex-shrink:0;background:var(--bg2);}
.con-title{font-size:11px;font-weight:700;color:var(--text2);display:flex;align-items:center;gap:7px;}
.con-cnt{font-size:9px;font-weight:800;padding:2px 6px;border-radius:10px;background:var(--surf);color:var(--text3);}
.con-cnt.err{background:rgba(255,107,157,.15);color:var(--acc3);}
.con-clr{background:transparent;border:none;color:var(--text3);font-size:10px;font-weight:700;cursor:pointer;padding:2px 6px;}
.con-body{flex:1;overflow-y:auto;padding:8px;}
.con-line{font-family:monospace;font-size:11px;padding:3px 8px;border-radius:4px;margin-bottom:2px;display:flex;align-items:flex-start;gap:8px;line-height:1.5;}
.con-line.log{color:#c8d3f5;}.con-line.warn{color:var(--gold);background:rgba(247,201,72,.06);}.con-line.error{color:var(--acc3);background:rgba(255,107,157,.06);}.con-line.info{color:var(--css);}
.cl-t{font-size:9px;font-weight:800;opacity:.7;flex-shrink:0;margin-top:1px;}
.con-empty{font-family:monospace;font-size:11px;color:var(--text3);padding:12px 8px;font-style:italic;}
.resize-h{width:4px;flex-shrink:0;background:transparent;cursor:col-resize;transition:background .15s;}
.resize-h:hover{background:var(--acc);}
.pg-sb{width:195px;flex-shrink:0;background:var(--bg2);border-right:1px solid var(--border);display:flex;flex-direction:column;}
.pg-sb-hd{padding:12px;border-bottom:1px solid var(--border);}
.pg-sb-lbl{font-size:9px;font-weight:800;letter-spacing:2px;text-transform:uppercase;color:var(--text3);margin-bottom:8px;}
.pg-sb-new{width:100%;padding:8px;border:none;border-radius:7px;background:linear-gradient(135deg,var(--acc),#9b6eff);color:#fff;font-size:11px;font-weight:700;cursor:pointer;}
.pg-sb-scroll{flex:1;overflow-y:auto;padding:6px;}
.snip-item{padding:9px 10px;border-radius:7px;cursor:pointer;border:1px solid transparent;margin-bottom:2px;transition:all .15s;}
.snip-item:hover{background:var(--surf);border-color:var(--border);}
.snip-item.active{background:var(--surf2);border-color:var(--acc);}
.snip-hdr{display:flex;align-items:center;justify-content:space-between;gap:6px;}
.snip-name{font-size:11px;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1;}
.snip-tags{display:flex;gap:3px;flex-wrap:wrap;margin-top:4px;}
.stag{font-size:9px;font-weight:700;padding:1px 5px;border-radius:3px;}
.stag-html{background:rgba(249,115,22,.12);color:var(--html);}.stag-css{background:rgba(59,158,255,.12);color:var(--css);}.stag-js{background:rgba(247,201,72,.12);color:var(--js);}
.snip-del{background:transparent;border:none;color:transparent;font-size:11px;cursor:pointer;padding:2px 4px;border-radius:3px;flex-shrink:0;}
.snip-item:hover .snip-del{color:var(--text3);}.snip-del:hover{color:var(--acc3)!important;}
/* BUILDER PC */
.bl-layout{flex:1;display:flex;overflow:hidden;}
.bl-palette{width:215px;flex-shrink:0;background:var(--bg2);border-right:1px solid var(--border);display:flex;flex-direction:column;overflow:hidden;}
.bl-pal-hd{padding:12px;border-bottom:1px solid var(--border);flex-shrink:0;}
.bl-pal-lbl{font-size:9px;font-weight:800;letter-spacing:2px;text-transform:uppercase;color:var(--text3);margin-bottom:8px;}
.bl-search{width:100%;padding:7px 10px;background:var(--bg);border:1px solid var(--border);border-radius:7px;color:var(--text);font-size:12px;outline:none;}
.bl-search:focus{border-color:var(--acc);}
.bl-pal-scroll{flex:1;overflow-y:auto;padding:8px;}
.bl-cat-lbl{font-size:9px;font-weight:800;letter-spacing:1.5px;text-transform:uppercase;color:var(--text3);padding:8px 4px 5px;margin-top:4px;}
.bl-comp-btn{display:flex;align-items:center;gap:8px;width:100%;padding:8px 10px;border:1px solid var(--border);border-radius:7px;background:transparent;color:var(--text2);font-size:11px;font-weight:600;cursor:pointer;margin-bottom:3px;transition:all .15s;text-align:left;}
.bl-comp-btn:hover{background:var(--surf);border-color:var(--border2);color:var(--text);}
.bl-comp-icon{font-size:14px;width:22px;flex-shrink:0;text-align:center;}
.bl-canvas-area{flex:1;display:flex;flex-direction:column;overflow:hidden;background:var(--bg3);}
.bl-canvas-topbar{display:flex;align-items:center;justify-content:space-between;padding:8px 16px;border-bottom:1px solid var(--border);flex-shrink:0;background:var(--bg2);}
.bl-canvas-title{font-size:11px;font-weight:700;color:var(--text3);display:flex;align-items:center;gap:6px;}
.bl-canvas-acts{display:flex;gap:5px;}
.bl-canvas-wrap{flex:1;overflow:hidden;position:relative;}
.bl-canvas-wrap iframe{width:100%;height:100%;border:none;display:block;}
.bl-empty-state{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;pointer-events:none;}
.bl-empty-icon{font-size:48px;opacity:.3;}
.bl-empty-txt{font-size:15px;font-weight:700;color:var(--text2);}
.bl-empty-sub{font-size:12px;color:var(--text3);}
.bl-props{width:270px;flex-shrink:0;background:var(--bg2);border-left:1px solid var(--border);display:flex;flex-direction:column;overflow:hidden;}
.bl-props-hd{padding:12px 14px;border-bottom:1px solid var(--border);flex-shrink:0;}
.bl-props-title{font-size:9px;font-weight:800;letter-spacing:2px;text-transform:uppercase;color:var(--text3);}
.bl-props-name{font-size:13px;font-weight:700;color:var(--text);margin-top:3px;}
.bl-props-scroll{flex:1;overflow-y:auto;padding:14px;}
.bl-props-empty{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:8px;color:var(--text3);font-size:12px;padding:20px;text-align:center;}
.bl-prop-group{margin-bottom:12px;}
.bl-prop-label{font-size:10px;font-weight:800;letter-spacing:.8px;text-transform:uppercase;color:var(--text2);margin-bottom:5px;}
.bl-prop-input,.bl-prop-sel{width:100%;padding:7px 10px;background:var(--bg);border:1px solid var(--border);border-radius:6px;color:var(--text);font-size:12px;outline:none;font-family:inherit;}
.bl-prop-input:focus,.bl-prop-sel:focus{border-color:var(--acc);}
.bl-prop-sel{padding-right:28px;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='7'%3E%3Cpath fill='%2350506a' d='M5 7L0 0h10z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 8px center;cursor:pointer;}
.bl-prop-ta{width:100%;padding:7px 10px;background:var(--bg);border:1px solid var(--border);border-radius:6px;color:var(--text);font-size:12px;outline:none;font-family:inherit;resize:vertical;min-height:60px;line-height:1.5;}
.bl-prop-ta:focus{border-color:var(--acc);}
.bl-prop-tog{display:flex;align-items:center;gap:8px;cursor:pointer;padding:5px 0;}
.bl-prop-tog .tknob{width:28px;height:16px;flex-shrink:0;}
.bl-prop-tog .tknob::after{width:10px;height:10px;top:2px;left:2px;}
.bl-prop-tog.checked .tknob{background:var(--acc);border-color:var(--acc);}
.bl-prop-tog.checked .tknob::after{left:14px;background:#fff;}
.bl-prop-tog span{font-size:12px;font-weight:600;color:var(--text2);}
.bl-prop-color{display:flex;align-items:center;gap:6px;}
.bl-prop-color input[type=color]{width:32px;height:28px;border:1px solid var(--border);border-radius:5px;padding:2px;background:transparent;cursor:pointer;}
.bl-prop-color .bl-prop-input{flex:1;}
.bl-props-foot{padding:10px 14px;border-top:1px solid var(--border);display:flex;gap:5px;flex-shrink:0;}
.bl-act-btn{padding:5px 9px;background:var(--surf);border:1px solid var(--border);border-radius:5px;color:var(--text3);font-size:11px;cursor:pointer;transition:all .15s;}
.bl-act-btn:hover{border-color:var(--border2);color:var(--text);}
.bl-act-btn.danger:hover{border-color:var(--acc3);color:var(--acc3);}
.bl-code-panel{width:0;flex-shrink:0;background:var(--bg3);border-left:1px solid var(--border);display:flex;flex-direction:column;overflow:hidden;transition:width .3s;}
.bl-code-panel.open{width:380px;}
.bl-code-hd{display:flex;align-items:center;justify-content:space-between;padding:10px 14px;border-bottom:1px solid var(--border);flex-shrink:0;}
pre.bl-code{padding:16px;font-family:'Courier New',monospace;font-size:11px;line-height:1.65;color:#c8d3f5;white-space:pre-wrap;word-break:break-all;margin:0;}
}
/* ‚îÄ‚îÄ MOBILE ‚îÄ‚îÄ */
@media(max-width:768px){
.pc-only{display:none!important;}
#app{display:flex;flex-direction:column;height:100%;height:100dvh;}
.m-topbar{display:flex;align-items:center;justify-content:space-between;padding:0 16px;padding-top:var(--safe-t);height:calc(52px + var(--safe-t));background:var(--bg2);border-bottom:1px solid var(--border);flex-shrink:0;}
.logo{display:flex;align-items:center;gap:8px;font-size:15px;font-weight:800;}
.logo-gem{width:28px;height:28px;background:linear-gradient(135deg,var(--acc),var(--acc2));border-radius:7px;display:flex;align-items:center;justify-content:center;font-size:13px;flex-shrink:0;}
.logo-kz{color:var(--acc);}.logo-by{color:var(--text3);font-weight:400;font-size:12px;}
.m-topbar-right{display:flex;align-items:center;gap:8px;}
.m-menu-btn{width:36px;height:36px;background:var(--surf);border:1px solid var(--border);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:16px;cursor:pointer;color:var(--text2);}
.m-run-btn{height:36px;padding:0 14px;background:linear-gradient(135deg,var(--acc2),#00c49a);border:none;border-radius:8px;color:#000;font-size:12px;font-weight:800;cursor:pointer;display:flex;align-items:center;gap:5px;}
.m-run-btn.running{animation:pulse .6s ease infinite alternate;}
.m-content{flex:1;overflow:hidden;display:flex;flex-direction:column;position:relative;}
.m-view{flex:1;overflow:hidden;display:flex;flex-direction:column;}
.m-view.hidden{display:none!important;}
/* Apex mobile */
.apex-mobile{flex:1;overflow:hidden;display:flex;flex-direction:column;}
.apex-panel-wrap{display:flex;flex:1;overflow:hidden;transition:transform .3s cubic-bezier(.4,0,.2,1);width:200%;}
.apex-panel-wrap.show-code{transform:translateX(-50%);}
.apex-form-mobile,.apex-code-mobile{width:50%;flex-shrink:0;display:flex;flex-direction:column;overflow:hidden;}
.m-section-tabs{display:flex;background:var(--bg2);border-bottom:1px solid var(--border);overflow-x:auto;flex-shrink:0;scrollbar-width:none;}
.m-section-tabs::-webkit-scrollbar{display:none;}
.m-stab{padding:12px 16px;border:none;background:transparent;color:var(--text3);font-size:12px;font-weight:700;cursor:pointer;white-space:nowrap;border-bottom:2px solid transparent;transition:all .15s;flex-shrink:0;}
.m-stab.active{color:var(--acc);border-bottom-color:var(--acc);}
.m-form-body{flex:1;overflow-y:auto;padding:16px;-webkit-overflow-scrolling:touch;}
.m-form-footer{padding:12px 16px;padding-bottom:calc(12px + var(--safe-b));border-top:1px solid var(--border);background:var(--bg2);display:flex;gap:8px;flex-shrink:0;}
.m-btn-save{flex:1;padding:13px;background:linear-gradient(135deg,var(--acc),#9b6eff);border:none;border-radius:10px;color:#fff;font-size:14px;font-weight:700;cursor:pointer;}
.m-btn-gen{flex:1;padding:13px;background:linear-gradient(135deg,var(--acc2),#00b894);border:none;border-radius:10px;color:#000;font-size:14px;font-weight:700;cursor:pointer;}
.m-btn-back{padding:13px 16px;background:var(--surf);border:1px solid var(--border);border-radius:10px;color:var(--text2);font-size:13px;font-weight:700;cursor:pointer;}
.m-code-header{display:flex;align-items:center;justify-content:space-between;padding:10px 14px;background:var(--bg2);border-bottom:1px solid var(--border);flex-shrink:0;}
.m-code-tabs{display:flex;background:var(--surf);border-radius:8px;padding:3px;gap:2px;overflow-x:auto;scrollbar-width:none;}
.m-code-tabs::-webkit-scrollbar{display:none;}
.m-ctab{padding:5px 10px;border:none;border-radius:5px;background:transparent;color:var(--text3);font-size:11px;font-weight:700;cursor:pointer;white-space:nowrap;}
.m-ctab.active{background:var(--bg4);color:var(--text);}
.m-code-acts{display:flex;gap:6px;}
.m-act-btn{padding:7px 10px;background:var(--surf);border:1px solid var(--border);border-radius:7px;color:var(--text2);font-size:11px;font-weight:700;cursor:pointer;}
.m-code-scroll{flex:1;overflow-y:auto;padding:12px;-webkit-overflow-scrolling:touch;}
.m-code-block{background:var(--bg2);border:1px solid var(--border);border-radius:10px;overflow:hidden;margin-bottom:12px;}
.m-cbh{display:flex;align-items:center;justify-content:space-between;padding:9px 12px;background:var(--surf);border-bottom:1px solid var(--border);}
.m-cbh-l{display:flex;align-items:center;gap:7px;font-size:11px;font-weight:700;color:var(--text2);}
.m-cbdot{width:6px;height:6px;border-radius:50%;}
.m-cbc{background:transparent;border:1px solid var(--border);color:var(--text3);padding:4px 10px;border-radius:4px;font-size:10px;font-weight:700;cursor:pointer;}
pre.m-apex{padding:14px;font-family:'Courier New',monospace;font-size:11px;line-height:1.6;overflow-x:auto;margin:0;color:#c8d3f5;}
.m-code-footer{padding:12px 16px;padding-bottom:calc(12px + var(--safe-b));border-top:1px solid var(--border);background:var(--bg2);flex-shrink:0;}
/* PG mobile */
.pg-mobile{flex:1;overflow:hidden;display:flex;flex-direction:column;}
.pg-lang-bar{display:flex;background:var(--bg2);border-bottom:1px solid var(--border);flex-shrink:0;}
.pg-ltab{flex:1;padding:11px 8px;border:none;background:transparent;color:var(--text3);font-size:12px;font-weight:700;cursor:pointer;border-bottom:2px solid transparent;transition:all .15s;display:flex;align-items:center;justify-content:center;gap:5px;}
.pg-ltab .ldot{width:7px;height:7px;border-radius:50%;}
.pg-ltab.active[data-lang=html]{color:var(--html);border-bottom-color:var(--html);}
.pg-ltab.active[data-lang=css]{color:var(--css);border-bottom-color:var(--css);}
.pg-ltab.active[data-lang=js]{color:var(--js);border-bottom-color:var(--js);}
.pg-ltab.active[data-lang=preview]{color:var(--acc2);border-bottom-color:var(--acc2);}
.pg-ltab.active{background:var(--surf);}
.m-editor-wrap{flex:1;overflow:hidden;display:flex;flex-direction:column;position:relative;}
.m-editor-inner{flex:1;display:flex;overflow:hidden;}
.m-line-nums{padding:14px 0 14px 10px;background:var(--bg2);color:var(--text3);text-align:right;user-select:none;border-right:1px solid var(--border);overflow:hidden;min-width:38px;line-height:1.7;font-size:12px;flex-shrink:0;font-family:'Courier New',monospace;}
.m-code-ta{flex:1;padding:14px 12px;background:transparent;border:none;color:var(--text);font-family:'Courier New',monospace;font-size:16px;line-height:1.7;resize:none;outline:none;tab-size:2;-webkit-overflow-scrolling:touch;}
.m-preview-wrap{flex:1;display:flex;flex-direction:column;overflow:hidden;}
.m-preview-bar{display:flex;align-items:center;justify-content:space-between;padding:8px 14px;background:var(--bg2);border-bottom:1px solid var(--border);flex-shrink:0;}
.m-pv-title{font-size:11px;font-weight:700;color:var(--text3);display:flex;align-items:center;gap:6px;}
.m-pv-refresh{padding:6px 12px;background:var(--surf);border:1px solid var(--border);border-radius:6px;color:var(--text2);font-size:11px;font-weight:700;cursor:pointer;}
.m-preview-frame{flex:1;background:#fff;position:relative;}
.m-preview-frame iframe{width:100%;height:100%;border:none;display:block;}
.m-pv-ind{position:absolute;top:10px;left:50%;transform:translateX(-50%);font-size:11px;font-weight:800;padding:5px 14px;border-radius:20px;background:rgba(0,229,180,.9);color:#000;opacity:0;transition:opacity .3s;pointer-events:none;z-index:10;white-space:nowrap;}
.m-pv-ind.show{opacity:1;}
.m-console{position:fixed;left:0;right:0;bottom:0;background:var(--bg2);border-top:2px solid var(--border);z-index:150;transform:translateY(calc(100% - 40px));transition:transform .3s cubic-bezier(.4,0,.2,1);display:flex;flex-direction:column;max-height:50dvh;padding-bottom:var(--safe-b);}
.m-console.open{transform:translateY(0);}
.m-con-pull{display:flex;align-items:center;justify-content:space-between;padding:10px 14px 8px;cursor:pointer;}
.m-con-bar{width:36px;height:4px;background:var(--border2);border-radius:2px;}
.m-con-title{font-size:11px;font-weight:700;color:var(--text2);display:flex;align-items:center;gap:7px;}
.m-con-cnt{font-size:9px;font-weight:800;padding:2px 6px;border-radius:10px;background:var(--surf);color:var(--text3);}
.m-con-cnt.err{background:rgba(255,107,157,.15);color:var(--acc3);}
.m-con-body{flex:1;overflow-y:auto;padding:8px 14px;-webkit-overflow-scrolling:touch;}
/* Builder mobile */
.bl-mobile{flex:1;overflow:hidden;display:flex;flex-direction:column;}
.bl-m-tabs{display:flex;background:var(--bg2);border-bottom:1px solid var(--border);flex-shrink:0;}
.bl-m-tab{flex:1;padding:10px 4px;border:none;background:transparent;color:var(--text3);font-size:10px;font-weight:700;cursor:pointer;border-bottom:2px solid transparent;transition:all .15s;display:flex;flex-direction:column;align-items:center;gap:2px;}
.bl-m-tab-icon{font-size:16px;}
.bl-m-tab.active{color:var(--acc3);border-bottom-color:var(--acc3);background:var(--surf);}
.bl-m-view{flex:1;overflow:hidden;display:flex;flex-direction:column;}
.bl-m-view.hidden{display:none!important;}
.bl-m-comp-scroll{flex:1;overflow-y:auto;padding:12px;-webkit-overflow-scrolling:touch;}
.bl-m-cat-lbl{font-size:9px;font-weight:800;letter-spacing:2px;text-transform:uppercase;color:var(--text3);margin:12px 0 7px 2px;}
.bl-m-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:7px;margin-bottom:4px;}
.bl-m-comp-btn{display:flex;flex-direction:column;align-items:center;gap:5px;padding:12px 6px;background:var(--surf);border:1px solid var(--border);border-radius:10px;cursor:pointer;transition:all .15s;font-size:11px;font-weight:600;color:var(--text2);border:none;}
.bl-m-comp-btn:active{transform:scale(.94);background:var(--surf2);}
.bl-m-icon{font-size:20px;}
.bl-m-canvas-wrap{flex:1;overflow:hidden;position:relative;background:#f0f4f8;}
.bl-m-canvas-wrap iframe{width:100%;height:100%;border:none;display:block;}
.bl-m-props-scroll{flex:1;overflow-y:auto;padding:14px;-webkit-overflow-scrolling:touch;}
.bl-m-props-empty{flex:1;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:8px;color:var(--text3);font-size:12px;padding:20px;text-align:center;}
.bl-m-code-scroll{flex:1;overflow-y:auto;}
pre.bl-m-code{padding:14px;font-family:'Courier New',monospace;font-size:11px;line-height:1.6;color:#c8d3f5;white-space:pre-wrap;word-break:break-all;margin:0;}
.bl-m-code-footer{padding:12px 16px;padding-bottom:calc(12px + var(--safe-b));border-top:1px solid var(--border);background:var(--bg2);flex-shrink:0;display:flex;gap:8px;}
/* Bottom Nav */
.m-bottom-nav{display:flex;background:var(--bg2);border-top:1px solid var(--border);padding-bottom:var(--safe-b);flex-shrink:0;}
.m-nav-btn{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:3px;padding:10px 8px;border:none;background:transparent;color:var(--text3);cursor:pointer;transition:all .15s;}
.m-nav-btn.active{color:var(--acc);}
.m-nav-icon{font-size:18px;line-height:1;}
.m-nav-label{font-size:9px;font-weight:800;letter-spacing:.5px;text-transform:uppercase;}
.m-nav-btn.active .m-nav-icon{transform:scale(1.1);}
.m-fab{position:fixed;right:16px;bottom:calc(var(--safe-b) + 72px);width:50px;height:50px;background:linear-gradient(135deg,var(--acc),#9b6eff);border:none;border-radius:50%;color:#fff;font-size:22px;cursor:pointer;box-shadow:0 4px 20px rgba(124,111,255,.5);display:flex;align-items:center;justify-content:center;transition:all .2s;z-index:50;}
.m-fab:active{transform:scale(.9);}
.m-fab.hidden{display:none;}
}
</style>
</head>
<body>
<div id="app">
<div class="drawer-overlay mobile-only" id="drawerOverlay" onclick="closeDrawer()"></div>
<div class="drawer mobile-only" id="drawer">
  <div class="drawer-head"><span class="drawer-title" id="drawerTitle">Projects</span><button class="drawer-close" onclick="closeDrawer()">‚úï</button></div>
  <button class="drawer-new" id="drawerNewBtn" onclick="drawerNewAction()">Ôºã New</button>
  <div class="drawer-list" id="drawerList"></div>
</div>

<!-- PC -->
<div class="pc-only" id="pcLayout" style="display:flex;flex-direction:column;height:100vh;">
  <div class="pc-topbar">
    <div class="logo"><div class="logo-gem">üé∏</div>Jam <span class="logo-by">by</span> <span class="logo-kz">Kz</span></div>
    <div class="mode-sw">
      <button class="mode-btn active" id="pc-mApex" onclick="pcSwitchMode('apex')"><div class="dot" style="background:var(--acc)"></div>Apex Builder</button>
      <button class="mode-btn" id="pc-mPlay" onclick="pcSwitchMode('playground')"><div class="dot" style="background:var(--acc2)"></div>Playground</button>
      <button class="mode-btn" id="pc-mBuild" onclick="pcSwitchMode('builder')"><div class="dot" style="background:var(--acc3)"></div>UI Designer</button>
    </div>
    <span class="chip">OFFLINE</span>
  </div>
  <div class="pc-body">

    <!-- APEX -->
    <div class="pc-view" id="pc-apex">
      <div class="pc-sidebar">
        <div class="sb-hd"><div class="sb-lbl">Integrations</div><button class="sb-new" onclick="apexNew()">Ôºã New Integration</button></div>
        <div class="sb-list" id="pc-apex-list"></div>
      </div>
      <div class="pc-form">
        <div class="fp-hd">
          <div class="fp-title">Configuration</div>
          <div class="tabs-row">
            <button class="tab-btn active" onclick="pcApexTab('basic',this)">Basic</button>
            <button class="tab-btn" onclick="pcApexTab('headers',this)">Headers</button>
            <button class="tab-btn" onclick="pcApexTab('body',this)">Body</button>
            <button class="tab-btn" onclick="pcApexTab('options',this)">Options</button>
          </div>
        </div>
        <div class="form-scroll" id="pc-form-scroll">
          <input type="hidden" id="apexId">
          <div id="pct-basic">
            <div class="fg"><div class="flabel">Class Name</div><input class="fi" id="aC" placeholder="e.g. JifflenowService" oninput="apexPreview()"><div class="fhint">// Generates .cls + Mock.cls + Test.cls</div></div>
            <div class="fg"><div class="flabel">Endpoint URL</div><input class="fi" id="aUrl" placeholder="https://api.example.com/v1/" oninput="apexPreview()"></div>
            <div class="frow">
              <div class="fg"><div class="flabel">Method</div><select class="fsel" id="aM" onchange="apexToggleBody();apexPreview()"><option>GET</option><option>POST</option><option>PUT</option><option>PATCH</option><option>DELETE</option></select></div>
              <div class="fg"><div class="flabel">Auth</div><select class="fsel" id="aAuth" onchange="apexAuthUI();apexPreview()"><option value="None">None</option><option value="NamedCredential">Named Credential</option><option value="Bearer">Bearer Token</option><option value="ApiKey">API Key</option></select></div>
            </div>
            <div class="fg hidden" id="aAuthValBox"><div class="flabel" id="aAuthLbl">Token Value</div><input class="fi" id="aAuthVal" placeholder="{!$Credential.Password}" oninput="apexPreview()"></div>
            <div class="fg"><div class="flabel">Expected Response JSON</div><textarea class="fta" id="aRes" placeholder='{ "status": "success", "id": 123 }' oninput="apexPreview()"></textarea><div class="json-st" id="aResStatus"></div></div>
          </div>
          <div id="pct-headers" class="hidden"><div class="fg"><div class="flabel">Custom Headers <button class="btn-sm" onclick="apexAddHeader()">+ Add</button></div><div id="aHdrCont"></div></div></div>
          <div id="pct-body" class="hidden">
            <div class="fg" id="aBodyBox"><div class="flabel">Request Body (JSON)</div><textarea class="fta" style="min-height:120px" id="aBody" oninput="apexPreview()"></textarea><div class="json-st" id="aBodyStatus"></div></div>
            <div class="toggle-row" id="aSerRow" onclick="apexToggleCb('aSer',this);apexPreview()"><input type="checkbox" id="aSer"><div class="tknob"></div><div><div class="tlbl">Use JSON.serialize()</div></div></div>
          </div>
          <div id="pct-options" class="hidden">
            <div class="toggle-row" id="aAsyncRow" onclick="apexToggleCb('aAsync',this);apexPreview()"><input type="checkbox" id="aAsync"><div class="tknob"></div><div><div class="tlbl">@future async callout</div></div></div>
            <div class="toggle-row checked" id="aLogRow" onclick="apexToggleCb('aLog',this);apexPreview()"><input type="checkbox" id="aLog" checked><div class="tknob"></div><div><div class="tlbl">Enhanced Debug Logging</div></div></div>
            <div class="toggle-row" id="aRetryRow" onclick="apexToggleCb('aRetry',this);apexPreview()"><input type="checkbox" id="aRetry"><div class="tknob"></div><div><div class="tlbl">Retry on Timeout</div></div></div>
            <div class="toggle-row" id="aTORow" onclick="apexToggleCb('aTO',this);apexPreview();toggleTOBox()"><input type="checkbox" id="aTO"><div class="tknob"></div><div><div class="tlbl">Custom Timeout</div></div></div>
            <div class="fg hidden" id="aTOValBox"><div class="flabel">Timeout (ms)</div><input type="number" class="fi" id="aTOVal" value="120000" min="1000" max="120000" step="1000" oninput="apexPreview()"></div>
            <hr class="sep">
            <div class="fg"><div class="flabel">Method Name</div><input class="fi" id="aMethod" value="executeCallout" oninput="apexPreview()"></div>
          </div>
        </div>
        <div class="fp-foot"><button class="btn-save" onclick="apexSave()">üíæ Save</button><button class="btn-reset" onclick="apexNew()">Reset</button></div>
      </div>
      <div class="apex-prev">
        <div class="prev-topbar">
          <div class="code-tabs">
            <button class="ctab active" onclick="pcApexCodeTab('all',this)">All</button>
            <button class="ctab" onclick="pcApexCodeTab('main',this)">Main</button>
            <button class="ctab" onclick="pcApexCodeTab('mock',this)">Mock</button>
            <button class="ctab" onclick="pcApexCodeTab('test',this)">Test</button>
          </div>
          <div class="prev-acts">
            <button class="btn-act" id="pcCopyAll" onclick="apexCopyAll()">‚éò Copy All</button>
            <button class="btn-act" onclick="apexDownload()">‚¨á Download</button>
          </div>
        </div>
        <div class="stats-bar">
          <div class="stat"><div class="sdot" style="background:var(--acc)"></div><span id="aStatLines">‚Äî</span></div>
          <div class="stat"><div class="sdot" style="background:var(--acc2)"></div><span>3 classes</span></div>
          <div class="stat"><div class="sdot" style="background:var(--gold)"></div><span id="aStatMeth">GET</span></div>
          <div class="stat"><div class="sdot" style="background:var(--text3)"></div><span id="aStatFeats">standard</span></div>
        </div>
        <div class="apex-code-area">
          <div class="code-block" id="pc-ab1"><div class="cbh"><div class="cbh-l"><div class="cbdot" style="background:var(--acc)"></div><span id="pcFn1">Main.cls</span></div><button class="cbc" onclick="copyBlock('pcCode1',this)">Copy</button></div><pre class="apex"><code id="pcCode1"></code></pre></div>
          <div class="code-block" id="pc-ab2"><div class="cbh"><div class="cbh-l"><div class="cbdot" style="background:var(--acc2)"></div><span id="pcFn2">Mock.cls</span></div><button class="cbc" onclick="copyBlock('pcCode2',this)">Copy</button></div><pre class="apex"><code id="pcCode2"></code></pre></div>
          <div class="code-block" id="pc-ab3"><div class="cbh"><div class="cbh-l"><div class="cbdot" style="background:var(--gold)"></div><span id="pcFn3">Test.cls</span></div><button class="cbc" onclick="copyBlock('pcCode3',this)">Copy</button></div><pre class="apex"><code id="pcCode3"></code></pre></div>
        </div>
      </div>
    </div>

    <!-- PLAYGROUND -->
    <div class="pc-view hidden" id="pc-playground">
      <div class="pg-sb">
        <div class="pg-sb-hd"><div class="pg-sb-lbl">Projects</div><button class="pg-sb-new" onclick="pgNew()">Ôºã New Project</button></div>
        <div class="pg-sb-scroll" id="pc-pg-list"></div>
      </div>
      <div class="pg-wrap">
        <div class="pg-topbar">
          <div class="pg-ftabs">
            <button class="pg-ftab active" data-lang="html" onclick="pgSwitch('html',this)"><div class="ftdot" style="background:var(--html)"></div>HTML</button>
            <button class="pg-ftab" data-lang="css" onclick="pgSwitch('css',this)"><div class="ftdot" style="background:var(--css)"></div>CSS</button>
            <button class="pg-ftab" data-lang="js" onclick="pgSwitch('js',this)"><div class="ftdot" style="background:var(--js)"></div>JS</button>
          </div>
          <div class="pg-acts">
            <div class="auto-tog on" id="pcAutoTog" onclick="pgToggleAuto()"><div class="auto-dot"></div>Auto</div>
            <button class="lay-btn active-lay" id="layS" onclick="pgLayout('split')">‚¨õ‚¨õ</button>
            <button class="lay-btn" id="layE" onclick="pgLayout('editor')">‚¨õ</button>
            <button class="lay-btn" id="layP" onclick="pgLayout('preview')">‚ñ∂</button>
            <button class="btn-act" onclick="pgToggleConsole()">Console</button>
            <button class="btn-run" id="pcRunBtn" onclick="pgRun()">‚ñ∂ Run</button>
            <button class="btn-act" onclick="pgSave()">üíæ Save</button>
            <button class="btn-act" onclick="pgDownload()">‚¨á</button>
          </div>
        </div>
        <div class="pg-main" id="pgMain">
          <div class="ed-pane half" id="edPane">
            <div class="ed-wrap">
              <div class="line-nums" id="pcLineNums">1</div>
              <textarea class="code-ta" id="pcEditor" spellcheck="false" oninput="pgEditorInput('pc')" onscroll="syncScroll('pc')" onkeydown="pgKeydown(event,'pc')"></textarea>
            </div>
          </div>
          <div class="resize-h" id="resizeH"></div>
          <div class="pv-pane half" id="pvPane">
            <div class="pv-hdr">
              <div class="pv-title"><div class="sdot" style="background:var(--acc2)"></div>Live Preview</div>
              <div style="display:flex;gap:5px;"><button class="pv-btn" onclick="pgFullscreen()">‚õ∂</button><button class="pv-btn" onclick="pgRun()">‚Ü∫</button></div>
            </div>
            <div class="pv-wrap"><iframe id="pcFrame" sandbox="allow-scripts allow-modals"></iframe><div class="pv-ind" id="pcInd">Updated</div></div>
            <div class="console-wrap" id="pcConsole">
              <div class="con-hdr"><div class="con-title">Console <span class="con-cnt" id="pcConCnt">0</span></div><button class="con-clr" onclick="clearConsole('pc')">Clear</button></div>
              <div class="con-body" id="pcConBody"><div class="con-empty">// Console output here</div></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- UI DESIGNER -->
    <div class="pc-view hidden" id="pc-builder">
      <div class="bl-layout">
        <div class="bl-palette">
          <div class="bl-pal-hd">
            <div class="bl-pal-lbl">üé® Components</div>
            <input class="bl-search" id="blSearch" placeholder="Search components..." oninput="blFilterComps(this.value)">
          </div>
          <div class="bl-pal-scroll" id="blPalScroll"></div>
        </div>
        <div class="bl-canvas-area">
          <div class="bl-canvas-topbar">
            <div class="bl-canvas-title"><div class="sdot" style="background:var(--acc3)"></div>Canvas ‚Äî <span id="blItemCount" style="color:var(--text3)">0 components</span></div>
            <div class="bl-canvas-acts">
              <button class="btn-act" id="blCodeToggle" onclick="blToggleCode()">‚å• View Code</button>
              <button class="btn-act" onclick="blClearCanvas()" style="color:var(--acc3)">‚úï Clear</button>
              <button class="btn-act" onclick="blDownload()">‚¨á Export HTML</button>
            </div>
          </div>
          <div style="display:flex;flex:1;overflow:hidden;">
            <div class="bl-canvas-wrap" style="flex:1;position:relative;">
              <iframe id="blFrame" sandbox="allow-scripts"></iframe>
              <div class="bl-empty-state" id="blEmptyState">
                <div class="bl-empty-icon">üé®</div>
                <div class="bl-empty-txt">Start Designing</div>
                <div class="bl-empty-sub">‚Üê Click any component to add it to the canvas</div>
              </div>
            </div>
            <div class="bl-code-panel" id="blCodePanel">
              <div class="bl-code-hd">
                <span style="font-size:11px;font-weight:800;color:var(--text2);letter-spacing:1px;text-transform:uppercase;">Generated Code</span>
                <button class="btn-act" onclick="blCopyCode()">‚éò Copy</button>
              </div>
              <div style="flex:1;overflow-y:auto;"><pre class="bl-code"><code id="blCodeOut">// Add components to see code</code></pre></div>
            </div>
          </div>
        </div>
        <div class="bl-props">
          <div class="bl-props-hd">
            <div class="bl-props-title">Properties</div>
            <div class="bl-props-name" id="blPropsName">‚Äî</div>
          </div>
          <div id="blPropsEmpty" class="bl-props-empty"><span style="font-size:24px">üëÜ</span><span>Click a component on the canvas to edit its properties</span></div>
          <div class="bl-props-scroll hidden" id="blPropsScroll"></div>
          <div class="bl-props-foot hidden" id="blPropsFoot">
            <button class="bl-act-btn" onclick="blMoveSelected(-1)" title="Move Up">‚Üë</button>
            <button class="bl-act-btn" onclick="blMoveSelected(1)" title="Move Down">‚Üì</button>
            <button class="bl-act-btn" onclick="blDuplicateSelected()" title="Duplicate">‚äï Dup</button>
            <button class="bl-act-btn danger" onclick="blDeleteSelected()" title="Delete">‚úï Del</button>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- MOBILE -->
<div class="mobile-only" id="mobileLayout" style="display:flex;flex-direction:column;height:100%;height:100dvh;">
  <div class="m-topbar">
    <div class="logo"><div class="logo-gem">üé∏</div>Jam <span class="logo-by">by</span> <span class="logo-kz">Kz</span></div>
    <div class="m-topbar-right">
      <button class="m-menu-btn" id="mMenuBtn" onclick="openDrawer()">‚ò∞</button>
      <button class="m-run-btn hidden" id="mRunBtn" onclick="pgRunMobile()">‚ñ∂ Run</button>
    </div>
  </div>
  <div class="m-content">

    <!-- APEX MOBILE -->
    <div class="m-view" id="m-apex">
      <div class="apex-mobile">
        <div class="apex-panel-wrap" id="apexPanelWrap">
          <div class="apex-form-mobile">
            <div class="m-section-tabs">
              <button class="m-stab active" onclick="mApexTab('basic',this)">Basic</button>
              <button class="m-stab" onclick="mApexTab('headers',this)">Headers</button>
              <button class="m-stab" onclick="mApexTab('body',this)">Body</button>
              <button class="m-stab" onclick="mApexTab('options',this)">Options</button>
            </div>
            <div class="m-form-body">
              <div id="mt-basic">
                <div class="fg"><div class="flabel">Class Name</div><input class="fi" id="mC" placeholder="e.g. JifflenowService" oninput="apexPreview()"></div>
                <div class="fg"><div class="flabel">Endpoint URL</div><input class="fi" id="mUrl" placeholder="https://api.example.com/v1/" oninput="apexPreview()"></div>
                <div class="frow">
                  <div class="fg"><div class="flabel">Method</div><select class="fsel" id="mM" onchange="apexToggleBody();apexPreview()"><option>GET</option><option>POST</option><option>PUT</option><option>PATCH</option><option>DELETE</option></select></div>
                  <div class="fg"><div class="flabel">Auth</div><select class="fsel" id="mAuth" onchange="apexAuthUI();apexPreview()"><option value="None">None</option><option value="NamedCredential">Named Credential</option><option value="Bearer">Bearer Token</option><option value="ApiKey">API Key</option></select></div>
                </div>
                <div class="fg hidden" id="mAuthValBox"><div class="flabel" id="mAuthLbl">Token Value</div><input class="fi" id="mAuthVal" oninput="apexPreview()"></div>
                <div class="fg"><div class="flabel">Expected Response JSON</div><textarea class="fta" id="mRes" placeholder='{ "status": "success" }' oninput="apexPreview()"></textarea><div class="json-st" id="mResStatus"></div></div>
              </div>
              <div id="mt-headers" class="hidden"><div class="fg"><div class="flabel">Custom Headers <button class="btn-sm" onclick="apexAddHeader()">+ Add</button></div><div id="mHdrCont"></div></div></div>
              <div id="mt-body" class="hidden">
                <div class="fg" id="mBodyBox"><div class="flabel">Request Body</div><textarea class="fta" style="min-height:120px" id="mBody" oninput="apexPreview()"></textarea></div>
                <div class="toggle-row" id="mSerRow" onclick="apexToggleCb('mSer',this);apexPreview()"><input type="checkbox" id="mSer"><div class="tknob"></div><div><div class="tlbl">Use JSON.serialize()</div></div></div>
              </div>
              <div id="mt-options" class="hidden">
                <div class="toggle-row" id="mAsyncRow" onclick="apexToggleCb('mAsync',this);apexPreview()"><input type="checkbox" id="mAsync"><div class="tknob"></div><div><div class="tlbl">@future async callout</div></div></div>
                <div class="toggle-row checked" id="mLogRow" onclick="apexToggleCb('mLog',this);apexPreview()"><input type="checkbox" id="mLog" checked><div class="tknob"></div><div><div class="tlbl">Enhanced Debug Logging</div></div></div>
                <div class="toggle-row" id="mRetryRow" onclick="apexToggleCb('mRetry',this);apexPreview()"><input type="checkbox" id="mRetry"><div class="tknob"></div><div><div class="tlbl">Retry on Timeout</div></div></div>
                <div class="toggle-row" id="mTORow" onclick="apexToggleCb('mTO',this);apexPreview();mToggleTOBox()"><input type="checkbox" id="mTO"><div class="tknob"></div><div><div class="tlbl">Custom Timeout</div></div></div>
                <div class="fg hidden" id="mTOValBox"><div class="flabel">Timeout (ms)</div><input type="number" class="fi" id="mTOVal" value="120000" oninput="apexPreview()"></div>
                <hr class="sep">
                <div class="fg"><div class="flabel">Method Name</div><input class="fi" id="mMethod" value="executeCallout" oninput="apexPreview()"></div>
              </div>
            </div>
            <div class="m-form-footer">
              <button class="m-btn-save" onclick="apexSave()">üíæ Save</button>
              <button class="m-btn-gen" onclick="showApexCode()">‚ö° Generate ‚Üí</button>
            </div>
          </div>
          <div class="apex-code-mobile">
            <div class="m-code-header">
              <div class="m-code-tabs">
                <button class="m-ctab active" onclick="mApexCodeTab('all',this)">All</button>
                <button class="m-ctab" onclick="mApexCodeTab('main',this)">Main</button>
                <button class="m-ctab" onclick="mApexCodeTab('mock',this)">Mock</button>
                <button class="m-ctab" onclick="mApexCodeTab('test',this)">Test</button>
              </div>
              <div class="m-code-acts"><button class="m-act-btn" onclick="apexCopyAll()">‚éò</button></div>
            </div>
            <div class="m-code-scroll">
              <div class="m-code-block" id="m-ab1"><div class="m-cbh"><div class="m-cbh-l"><div class="m-cbdot" style="background:var(--acc)"></div><span id="mFn1">Main.cls</span></div><button class="m-cbc" onclick="copyBlock('mCode1',this)">Copy</button></div><pre class="m-apex"><code id="mCode1"></code></pre></div>
              <div class="m-code-block" id="m-ab2"><div class="m-cbh"><div class="m-cbh-l"><div class="m-cbdot" style="background:var(--acc2)"></div><span id="mFn2">Mock.cls</span></div><button class="m-cbc" onclick="copyBlock('mCode2',this)">Copy</button></div><pre class="m-apex"><code id="mCode2"></code></pre></div>
              <div class="m-code-block" id="m-ab3"><div class="m-cbh"><div class="m-cbh-l"><div class="m-cbdot" style="background:var(--gold)"></div><span id="mFn3">Test.cls</span></div><button class="m-cbc" onclick="copyBlock('mCode3',this)">Copy</button></div><pre class="m-apex"><code id="mCode3"></code></pre></div>
            </div>
            <div class="m-code-footer">
              <div style="display:flex;gap:8px;">
                <button class="m-btn-back" onclick="hideApexCode()">‚Üê Back</button>
                <button class="m-btn-save" onclick="apexDownload()">‚¨á Download</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- PLAYGROUND MOBILE -->
    <div class="m-view hidden" id="m-playground">
      <div class="pg-mobile">
        <div class="pg-lang-bar">
          <button class="pg-ltab active" data-lang="html" onclick="mPgSwitch('html',this)"><div class="ldot" style="background:var(--html)"></div>HTML</button>
          <button class="pg-ltab" data-lang="css" onclick="mPgSwitch('css',this)"><div class="ldot" style="background:var(--css)"></div>CSS</button>
          <button class="pg-ltab" data-lang="js" onclick="mPgSwitch('js',this)"><div class="ldot" style="background:var(--js)"></div>JS</button>
          <button class="pg-ltab" data-lang="preview" onclick="mPgSwitch('preview',this)"><div class="ldot" style="background:var(--acc2)"></div>Preview</button>
        </div>
        <div class="m-editor-wrap" id="mEditorWrap">
          <div class="m-editor-inner">
            <div class="m-line-nums" id="mLineNums">1</div>
            <textarea class="m-code-ta" id="mEditor" spellcheck="false" autocorrect="off" autocapitalize="off" oninput="pgEditorInput('m')" onscroll="syncScroll('m')" onkeydown="pgKeydown(event,'m')"></textarea>
          </div>
        </div>
        <div class="m-preview-wrap hidden" id="mPreviewWrap">
          <div class="m-preview-bar">
            <div class="m-pv-title"><div style="width:7px;height:7px;border-radius:50%;background:var(--acc2)"></div>Preview</div>
            <button class="m-pv-refresh" onclick="pgRunMobile()">‚Ü∫ Refresh</button>
          </div>
          <div class="m-preview-frame">
            <iframe id="mFrame" sandbox="allow-scripts allow-modals"></iframe>
            <div class="m-pv-ind" id="mInd">Updated ‚úì</div>
          </div>
        </div>
      </div>
      <div class="m-console" id="mConsole">
        <div class="m-con-pull" onclick="toggleMobileConsole()">
          <div class="m-con-title">Console <span class="m-con-cnt" id="mConCnt">0</span></div>
          <div class="m-con-bar"></div>
          <button class="con-clr" onclick="clearConsole('m');event.stopPropagation()">Clear</button>
        </div>
        <div class="m-con-body" id="mConBody"><div class="con-empty">// Console output here</div></div>
      </div>
    </div>

    <!-- BUILDER MOBILE -->
    <div class="m-view hidden" id="m-builder">
      <div class="bl-mobile">
        <div class="bl-m-tabs">
          <button class="bl-m-tab active" onclick="blMTab('add',this)"><div class="bl-m-tab-icon">Ôºã</div><span>Add</span></button>
          <button class="bl-m-tab" onclick="blMTab('canvas',this)"><div class="bl-m-tab-icon">üñº</div><span>Canvas</span></button>
          <button class="bl-m-tab" onclick="blMTab('props',this)"><div class="bl-m-tab-icon">‚öôÔ∏è</div><span>Props</span></button>
          <button class="bl-m-tab" onclick="blMTab('code',this)"><div class="bl-m-tab-icon">„Äà/„Äâ</div><span>Code</span></button>
        </div>
        <div class="bl-m-view" id="blm-add"><div class="bl-m-comp-scroll" id="blMPalScroll"></div></div>
        <div class="bl-m-view hidden" id="blm-canvas"><div class="bl-m-canvas-wrap"><iframe id="blMFrame" sandbox="allow-scripts"></iframe></div></div>
        <div class="bl-m-view hidden" id="blm-props">
          <div class="bl-m-props-empty" id="blMPropsEmpty"><span style="font-size:28px">üëÜ</span><span>Select a component on the Canvas tab to edit</span></div>
          <div class="hidden" id="blMPropsWrap" style="display:flex;flex-direction:column;flex:1;overflow:hidden;">
            <div style="padding:10px 14px;border-bottom:1px solid var(--border);flex-shrink:0;background:var(--bg2);display:flex;align-items:center;justify-content:space-between;">
              <span id="blMPropsName" style="font-size:13px;font-weight:700;"></span>
              <div style="display:flex;gap:5px;">
                <button class="bl-act-btn" onclick="blMoveSelected(-1)">‚Üë</button>
                <button class="bl-act-btn" onclick="blMoveSelected(1)">‚Üì</button>
                <button class="bl-act-btn" onclick="blDuplicateSelected()">‚äï</button>
                <button class="bl-act-btn danger" onclick="blDeleteSelected()">‚úï</button>
              </div>
            </div>
            <div class="bl-m-props-scroll" id="blMPropsScroll"></div>
          </div>
        </div>
        <div class="bl-m-view hidden" id="blm-code">
          <div class="bl-m-code-scroll"><pre class="bl-m-code"><code id="blMCodeOut">// Add components to see code</code></pre></div>
          <div class="bl-m-code-footer">
            <button class="m-btn-save" style="flex:1;" onclick="blCopyCode()">‚éò Copy Code</button>
            <button class="m-btn-gen" style="flex:1;" onclick="blDownload()">‚¨á Export</button>
          </div>
        </div>
      </div>
    </div>

  </div>
  <button class="m-fab" id="mFab" onclick="mFabAction()">Ôºã</button>
  <div class="m-bottom-nav">
    <button class="m-nav-btn active" id="m-nav-apex" onclick="mSwitchMode('apex')"><div class="m-nav-icon">‚ö°</div><div class="m-nav-label">Apex</div></button>
    <button class="m-nav-btn" id="m-nav-playground" onclick="mSwitchMode('playground')"><div class="m-nav-icon">üéÆ</div><div class="m-nav-label">Play</div></button>
    <button class="m-nav-btn" id="m-nav-builder" onclick="mSwitchMode('builder')"><div class="m-nav-icon">üé®</div><div class="m-nav-label">Design</div></button>
  </div>
</div>
</div>
<div class="toast" id="toast"><span>‚úì</span><span id="toastMsg"></span></div>
<script>
const IS_MOBILE = window.matchMedia('(max-width:768px)').matches;
document.getElementById('pcLayout').style.display  = IS_MOBILE ? 'none' : 'flex';
document.getElementById('mobileLayout').style.display = IS_MOBILE ? 'flex' : 'none';
window.matchMedia('(max-width:768px)').addEventListener('change', e => {
  document.getElementById('pcLayout').style.display  = e.matches ? 'none' : 'flex';
  document.getElementById('mobileLayout').style.display = e.matches ? 'flex' : 'none';
});

// STATE
let apexList = [];
try { apexList = JSON.parse(localStorage.getItem('jamKz_apex')) || []; } catch(e) { apexList = []; }
let pgProjects = [];
try { pgProjects = JSON.parse(localStorage.getItem('jamKz_pg')) || []; } catch(e) { pgProjects = []; }
let pgCurrentId = null, pgCurrentLang = 'html', pgAutoRun = true, pgAutoTimer = null;
let pgLayMode = 'split', pcConsoleOpen = false, mConsoleOpen = false;
let mCurrentMode = 'apex';

const PG_DEFAULT = {
  html:`<!DOCTYPE html>\n<html lang="en">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>My Project</title>\n</head>\n<body>\n  <div class="container">\n    <h1>Hello, Jam by Kz! üé∏</h1>\n    <p>Edit HTML, CSS &amp; JavaScript to see live results.</p>\n    <button onclick="handleClick()">Click me</button>\n    <div id="output"></div>\n  </div>\n</body>\n</html>`,
  css:`* { box-sizing: border-box; margin: 0; padding: 0; }\nbody { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #0f0f1e, #1a1a2e); min-height: 100vh; display: flex; align-items: center; justify-content: center; }\n.container { text-align: center; padding: 40px 20px; }\nh1 { font-size: clamp(1.8rem, 5vw, 2.5rem); color: #fff; margin-bottom: 16px; animation: fadeInDown .8s ease both; }\np { color: #9090b0; margin-bottom: 28px; font-size: 1.1rem; animation: fadeInUp .8s ease .2s both; }\nbutton { padding: 12px 32px; background: linear-gradient(135deg, #7c6fff, #00e5b4); border: none; border-radius: 50px; color: #fff; font-size: 1rem; font-weight: 700; cursor: pointer; transition: transform .2s; animation: fadeInUp .8s ease .4s both; }\nbutton:hover { transform: translateY(-3px); }\n#output { margin-top: 20px; font-size: 1.2rem; color: #00e5b4; font-weight: 700; min-height: 30px; }\n@keyframes fadeInDown { from { opacity:0; transform:translateY(-20px); } to { opacity:1; transform:translateY(0); } }\n@keyframes fadeInUp { from { opacity:0; transform:translateY(20px); } to { opacity:1; transform:translateY(0); } }`,
  js:`function handleClick() {\n  const msgs = ['üöÄ You built this!','üé∏ Jam by Kz!','‚ú® Keep creating!','üí° Ideas to reality.','üî• On fire!'];\n  const out = document.getElementById('output');\n  out.textContent = msgs[Math.floor(Math.random() * msgs.length)];\n  console.log('Clicked!', out.textContent);\n}\nconsole.log('‚úì Playground ready');`
};
let pgContents = { html: PG_DEFAULT.html, css: PG_DEFAULT.css, js: PG_DEFAULT.js };

// BUILDER STATE
let blItems = [], blSelectedId = null, blCodeOpen = false;

// BUILDER CSS
const JKZ_CSS = `*{box-sizing:border-box}body{margin:0;font-family:'Segoe UI',system-ui,sans-serif;color:#1a1a2e;background:#f8fafc}.jkz-wrap{padding:12px}.jkz-btn{display:inline-flex;align-items:center;justify-content:center;gap:6px;border:2px solid transparent;cursor:pointer;font-weight:600;transition:all .2s;font-family:inherit;line-height:1;text-decoration:none;letter-spacing:.2px}.jkz-btn-xs{padding:4px 10px;font-size:11px;border-radius:5px}.jkz-btn-sm{padding:7px 14px;font-size:13px;border-radius:7px}.jkz-btn-md{padding:10px 20px;font-size:14px;border-radius:8px}.jkz-btn-lg{padding:13px 26px;font-size:16px;border-radius:10px}.jkz-btn-xl{padding:16px 32px;font-size:18px;border-radius:12px}.jkz-btn-primary{background:#7c6fff;border-color:#7c6fff;color:#fff}.jkz-btn-primary:hover{background:#6a5de8;transform:translateY(-1px);box-shadow:0 4px 16px rgba(124,111,255,.4)}.jkz-btn-secondary{background:#64748b;border-color:#64748b;color:#fff}.jkz-btn-secondary:hover{background:#4e5d6c;transform:translateY(-1px)}.jkz-btn-outline{background:transparent;border-color:#7c6fff;color:#7c6fff}.jkz-btn-outline:hover{background:rgba(124,111,255,.1);transform:translateY(-1px)}.jkz-btn-ghost{background:transparent;border-color:transparent;color:#7c6fff}.jkz-btn-ghost:hover{background:rgba(124,111,255,.1)}.jkz-btn-danger{background:#ef4444;border-color:#ef4444;color:#fff}.jkz-btn-danger:hover{background:#dc2626;transform:translateY(-1px)}.jkz-btn-success{background:#22c55e;border-color:#22c55e;color:#fff}.jkz-btn-success:hover{background:#16a34a}.jkz-btn-warning{background:#f59e0b;border-color:#f59e0b;color:#000}.jkz-btn-warning:hover{background:#d97706}.jkz-btn-dark{background:#1e293b;border-color:#1e293b;color:#fff}.jkz-btn-dark:hover{background:#0f172a}.jkz-btn-link{background:transparent;border-color:transparent;color:#7c6fff;text-decoration:underline}.jkz-btn.jkz-fw{width:100%;display:flex}.jkz-btn.jkz-pill{border-radius:999px!important}.jkz-badge{display:inline-flex;align-items:center;gap:4px;font-size:11px;font-weight:700;letter-spacing:.3px;padding:3px 9px;border-radius:5px;white-space:nowrap}.jkz-badge.jkz-pill{border-radius:999px}.jkz-badge-sm{font-size:9px;padding:2px 6px}.jkz-badge-lg{font-size:13px;padding:5px 12px}.jkz-badge-primary{background:#ede9ff;color:#7c6fff;border:1px solid #c4b9ff}.jkz-badge-success{background:#ecfdf5;color:#059669;border:1px solid #a7f3d0}.jkz-badge-warning{background:#fffbeb;color:#d97706;border:1px solid #fde68a}.jkz-badge-danger{background:#fef2f2;color:#dc2626;border:1px solid #fecaca}.jkz-badge-info{background:#eff6ff;color:#2563eb;border:1px solid #bfdbfe}.jkz-badge-dark{background:#1e293b;color:#fff;border:1px solid #334155}.jkz-badge-neutral{background:#f1f5f9;color:#64748b;border:1px solid #cbd5e1}.jkz-alert{display:flex;align-items:flex-start;gap:12px;padding:14px 16px;border-radius:10px;border:1px solid;line-height:1.6;font-size:14px}.jkz-alert-icon{font-size:18px;flex-shrink:0}.jkz-alert-title{font-weight:700;margin-bottom:2px}.jkz-alert-info{background:#eff6ff;border-color:#bfdbfe;color:#1d4ed8}.jkz-alert-success{background:#ecfdf5;border-color:#a7f3d0;color:#065f46}.jkz-alert-warning{background:#fffbeb;border-color:#fde68a;color:#92400e}.jkz-alert-error{background:#fef2f2;border-color:#fecaca;color:#991b1b}.jkz-divider{display:flex;align-items:center;gap:12px;color:#94a3b8;font-size:12px;font-weight:600;margin:4px 0}.jkz-divider::before,.jkz-divider::after{content:'';flex:1;border-top:1px solid #e2e8f0}.jkz-divider.dashed::before,.jkz-divider.dashed::after{border-style:dashed}.jkz-divider.dotted::before,.jkz-divider.dotted::after{border-style:dotted}.jkz-divider.thick::before,.jkz-divider.thick::after{border-top-width:2px}.jkz-spinner{display:inline-block;border-radius:50%;animation:jkz-spin .7s linear infinite}.jkz-spinner-sm{width:18px;height:18px;border:2px solid #e2e8f0;border-top-color:#7c6fff}.jkz-spinner-md{width:32px;height:32px;border:3px solid #e2e8f0;border-top-color:#7c6fff}.jkz-spinner-lg{width:48px;height:48px;border:4px solid #e2e8f0;border-top-color:#7c6fff}.jkz-spinner-xl{width:64px;height:64px;border:5px solid #e2e8f0;border-top-color:#7c6fff}@keyframes jkz-spin{to{transform:rotate(360deg)}}.jkz-avatar{display:inline-flex;align-items:center;justify-content:center;font-weight:700;color:#fff;flex-shrink:0;position:relative;overflow:hidden}.jkz-avatar-sm{width:32px;height:32px;font-size:12px}.jkz-avatar-md{width:44px;height:44px;font-size:16px}.jkz-avatar-lg{width:60px;height:60px;font-size:22px}.jkz-avatar-xl{width:80px;height:80px;font-size:28px}.jkz-avatar.circle{border-radius:50%}.jkz-avatar.rounded{border-radius:14px}.jkz-avatar.square{border-radius:6px}.jkz-status{position:absolute;bottom:1px;right:1px;width:10px;height:10px;border-radius:50%;border:2px solid #fff}.jkz-status-online{background:#22c55e}.jkz-status-offline{background:#94a3b8}.jkz-status-away{background:#f59e0b}.jkz-status-busy{background:#ef4444}.jkz-h{font-weight:800;line-height:1.15;margin:0;color:#0f172a;letter-spacing:-.02em}.jkz-h1{font-size:3rem}.jkz-h2{font-size:2.25rem}.jkz-h3{font-size:1.875rem}.jkz-h4{font-size:1.5rem}.jkz-h5{font-size:1.25rem}.jkz-h6{font-size:1rem}.jkz-text{font-size:1rem;line-height:1.75;margin:0;color:#475569}.jkz-blockquote{border-left:4px solid #7c6fff;padding:14px 20px;margin:0;background:#faf8ff;color:#475569;font-style:italic;border-radius:0 10px 10px 0;font-size:15px;line-height:1.7}.jkz-blockquote cite{display:block;font-style:normal;font-weight:700;font-size:12px;margin-top:10px;color:#94a3b8}.jkz-code-block{background:#0f172a;border-radius:12px;overflow:hidden;font-family:'Courier New',monospace}.jkz-code-hdr{display:flex;align-items:center;justify-content:space-between;padding:10px 16px;background:#1e293b;font-size:11px;font-weight:700;letter-spacing:.5px;color:#94a3b8}.jkz-code-dots{display:flex;gap:5px;align-items:center}.jkz-code-dot{width:10px;height:10px;border-radius:50%}.jkz-code-pre{padding:18px;font-size:13px;line-height:1.65;margin:0;color:#e2e8f0;overflow-x:auto}.jkz-field{display:flex;flex-direction:column;gap:5px}.jkz-label{font-size:13px;font-weight:600;color:#374151}.jkz-label.req::after{content:' *';color:#ef4444}.jkz-input{padding:9px 12px;border:1.5px solid #d1d5db;border-radius:8px;font-size:14px;color:#1f2937;background:#fff;outline:none;font-family:inherit;transition:border-color .15s,box-shadow .15s;width:100%}.jkz-input:focus{border-color:#7c6fff;box-shadow:0 0 0 3px rgba(124,111,255,.15)}.jkz-input::placeholder{color:#9ca3af}.jkz-input.err{border-color:#ef4444}.jkz-textarea{padding:9px 12px;border:1.5px solid #d1d5db;border-radius:8px;font-size:14px;color:#1f2937;background:#fff;outline:none;font-family:inherit;resize:vertical;line-height:1.6;width:100%;transition:border-color .15s}.jkz-textarea:focus{border-color:#7c6fff;box-shadow:0 0 0 3px rgba(124,111,255,.15)}.jkz-select{padding:9px 32px 9px 12px;border:1.5px solid #d1d5db;border-radius:8px;font-size:14px;color:#1f2937;background:#fff url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='7'%3E%3Cpath fill='%236b7280' d='M5 7L0 0h10z'/%3E%3C/svg%3E") no-repeat right 10px center;-webkit-appearance:none;appearance:none;outline:none;font-family:inherit;cursor:pointer;width:100%;transition:border-color .15s}.jkz-select:focus{border-color:#7c6fff;box-shadow:0 0 0 3px rgba(124,111,255,.15)}.jkz-helper{font-size:12px;color:#6b7280}.jkz-helper.err{color:#ef4444}.jkz-check-wrap,.jkz-radio-wrap{display:flex;align-items:center;gap:10px;cursor:pointer;user-select:none}.jkz-check-box{width:18px;height:18px;border:2px solid #d1d5db;border-radius:4px;display:flex;align-items:center;justify-content:center;transition:all .15s;flex-shrink:0;font-size:12px;color:#fff;background:#fff}.jkz-check-box.on{background:#7c6fff;border-color:#7c6fff}.jkz-radio-dot{width:18px;height:18px;border:2px solid #d1d5db;border-radius:50%;display:flex;align-items:center;justify-content:center;transition:all .15s;flex-shrink:0;background:#fff}.jkz-radio-dot.on{border-color:#7c6fff}.jkz-radio-inner{width:8px;height:8px;border-radius:50%;background:#7c6fff}.jkz-opt-label{font-size:14px;color:#374151}.jkz-tog-wrap{display:flex;align-items:center;gap:10px;cursor:pointer;user-select:none}.jkz-tog-track{width:44px;height:24px;border-radius:999px;position:relative;transition:background .2s;flex-shrink:0}.jkz-tog-track.on{background:#7c6fff}.jkz-tog-track.off{background:#d1d5db}.jkz-tog-thumb{width:18px;height:18px;border-radius:50%;background:#fff;position:absolute;top:3px;transition:left .2s;box-shadow:0 1px 4px rgba(0,0,0,.25)}.jkz-tog-track.on .jkz-tog-thumb{left:23px}.jkz-tog-track.off .jkz-tog-thumb{left:3px}.jkz-tog-label{font-size:14px;color:#374151}.jkz-range-wrap{}.jkz-range-hdr{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}.jkz-range-lbl{font-size:13px;font-weight:600;color:#374151}.jkz-range-val{font-size:12px;font-weight:700;color:#7c6fff;background:#ede9ff;padding:2px 9px;border-radius:999px}.jkz-range{width:100%;accent-color:#7c6fff;height:5px;cursor:pointer}.jkz-card{background:#fff;border-radius:14px;overflow:hidden}.jkz-card-default{border:1px solid #e2e8f0}.jkz-card-elevated{box-shadow:0 4px 24px rgba(0,0,0,.08);border:1px solid #f1f5f9}.jkz-card-bordered{border:2px solid #7c6fff}.jkz-card-flat{background:#f8fafc}.jkz-card-header{padding:16px 20px;border-bottom:1px solid #f1f5f9;font-weight:700;font-size:16px;color:#0f172a}.jkz-card-body{padding:20px;font-size:14px;color:#475569;line-height:1.7}.jkz-card-footer{padding:12px 20px;border-top:1px solid #f1f5f9;background:#f8fafc;font-size:13px;color:#64748b;display:flex;align-items:center;gap:8px}.jkz-card-img{width:100%;height:180px;object-fit:cover;background:linear-gradient(135deg,#7c6fff22,#00e5b422);display:flex;align-items:center;justify-content:center;color:#94a3b8;font-size:13px}.jkz-grid{display:grid;gap:16px}.jkz-grid-2{grid-template-columns:repeat(2,1fr)}.jkz-grid-3{grid-template-columns:repeat(3,1fr)}.jkz-grid-item{background:#f8fafc;border:2px dashed #e2e8f0;border-radius:10px;padding:24px;text-align:center;color:#94a3b8;font-size:13px;min-height:80px;display:flex;align-items:center;justify-content:center}.jkz-hero{padding:80px 24px;text-align:center;position:relative;overflow:hidden}.jkz-hero-tag{display:inline-block;padding:5px 14px;border-radius:999px;font-size:12px;font-weight:700;background:rgba(124,111,255,.12);color:#7c6fff;margin-bottom:20px;letter-spacing:.3px}.jkz-hero-title{font-size:clamp(2rem,5vw,3.5rem);font-weight:800;line-height:1.1;margin:0 0 16px;letter-spacing:-.03em}.jkz-hero-sub{font-size:1.125rem;color:#64748b;margin:0 auto 36px;max-width:560px;line-height:1.75}.jkz-hero-acts{display:flex;align-items:center;justify-content:center;gap:12px;flex-wrap:wrap}.jkz-feature{display:flex;gap:16px;align-items:flex-start;padding:16px}.jkz-feature-icon{width:48px;height:48px;border-radius:12px;background:linear-gradient(135deg,#7c6fff,#9b6eff);display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0}.jkz-feature-title{font-size:16px;font-weight:700;margin:0 0 6px;color:#0f172a}.jkz-feature-desc{font-size:14px;color:#64748b;line-height:1.65;margin:0}.jkz-pricing{background:#fff;border:1px solid #e2e8f0;border-radius:18px;padding:32px;position:relative;overflow:hidden}.jkz-pricing.featured{border-color:#7c6fff;border-width:2px;box-shadow:0 8px 40px rgba(124,111,255,.15)}.jkz-pricing-badge{position:absolute;top:20px;right:20px;background:linear-gradient(135deg,#7c6fff,#9b6eff);color:#fff;font-size:11px;font-weight:700;padding:4px 12px;border-radius:999px}.jkz-pricing-plan{font-size:13px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:#94a3b8;margin-bottom:14px}.jkz-pricing-price{font-size:3.5rem;font-weight:800;color:#0f172a;line-height:1;margin-bottom:4px;letter-spacing:-.03em}.jkz-pricing-period{font-size:14px;color:#94a3b8;margin-bottom:24px}.jkz-pricing-features{list-style:none;padding:0;margin:0 0 28px}.jkz-pricing-features li{padding:10px 0;border-bottom:1px solid #f1f5f9;font-size:14px;color:#475569;display:flex;align-items:center;gap:10px}.jkz-pricing-features li::before{content:'‚úì';font-weight:700;color:#22c55e;flex-shrink:0}.jkz-tbl-wrap{overflow-x:auto;border-radius:12px;border:1px solid #e2e8f0;box-shadow:0 1px 6px rgba(0,0,0,.04)}.jkz-table{width:100%;border-collapse:collapse;font-size:14px}.jkz-table th{background:#f8fafc;padding:11px 16px;text-align:left;font-weight:700;font-size:11px;text-transform:uppercase;letter-spacing:.5px;color:#64748b;border-bottom:1px solid #e2e8f0}.jkz-table td{padding:11px 16px;border-bottom:1px solid #f1f5f9;color:#374151}.jkz-table.striped tbody tr:nth-child(even) td{background:#f8fafc}.jkz-table.hoverable tbody tr:hover td{background:#faf5ff}.jkz-table.compact th,.jkz-table.compact td{padding:7px 12px}.jkz-prog-wrap{}.jkz-prog-hdr{display:flex;justify-content:space-between;margin-bottom:7px;font-size:13px;font-weight:600;color:#374151}.jkz-prog-pct{font-size:13px;color:#94a3b8}.jkz-prog-track{background:#e2e8f0;border-radius:999px;overflow:hidden}.jkz-prog-bar{height:100%;border-radius:999px;transition:width .4s ease}.jkz-prog-primary .jkz-prog-bar{background:#7c6fff}.jkz-prog-success .jkz-prog-bar{background:#22c55e}.jkz-prog-warning .jkz-prog-bar{background:#f59e0b}.jkz-prog-danger .jkz-prog-bar{background:#ef4444}.jkz-prog-gradient .jkz-prog-bar{background:linear-gradient(90deg,#7c6fff,#00e5b4)}.jkz-prog-xs .jkz-prog-track{height:4px}.jkz-prog-sm .jkz-prog-track{height:6px}.jkz-prog-md .jkz-prog-track{height:10px}.jkz-prog-lg .jkz-prog-track{height:18px;border-radius:8px}.jkz-stat{padding:24px;border-radius:14px;background:#fff;border:1px solid #e2e8f0}.jkz-stat-label{font-size:12px;font-weight:700;text-transform:uppercase;letter-spacing:.8px;color:#94a3b8;margin-bottom:10px}.jkz-stat-val{font-size:2.5rem;font-weight:800;color:#0f172a;margin-bottom:10px;line-height:1;letter-spacing:-.03em}.jkz-stat-change{display:inline-flex;align-items:center;gap:4px;font-size:13px;font-weight:700;padding:3px 10px;border-radius:999px}.jkz-stat-up{background:#ecfdf5;color:#059669}.jkz-stat-down{background:#fef2f2;color:#dc2626}.jkz-stat-neutral{background:#f1f5f9;color:#64748b}.jkz-nav{display:flex;align-items:center;justify-content:space-between;padding:0 24px;height:58px}.jkz-nav-light{background:#fff;border-bottom:1px solid #e2e8f0}.jkz-nav-dark{background:#0f172a;border-bottom:1px solid #1e293b}.jkz-nav-primary{background:#7c6fff}.jkz-nav-glass{background:rgba(255,255,255,.9);backdrop-filter:blur(12px);border-bottom:1px solid rgba(0,0,0,.08)}.jkz-nav-brand{font-weight:800;font-size:18px;text-decoration:none}.jkz-nav-light .jkz-nav-brand{color:#0f172a}.jkz-nav-dark .jkz-nav-brand,.jkz-nav-primary .jkz-nav-brand{color:#fff}.jkz-nav-links{display:flex;align-items:center;gap:2px}.jkz-nav-link{padding:7px 13px;border-radius:8px;font-size:14px;font-weight:500;text-decoration:none;border:none;cursor:pointer;background:transparent;font-family:inherit;transition:all .15s}.jkz-nav-light .jkz-nav-link{color:#475569}.jkz-nav-light .jkz-nav-link:hover{background:#f1f5f9;color:#0f172a}.jkz-nav-dark .jkz-nav-link,.jkz-nav-primary .jkz-nav-link{color:rgba(255,255,255,.75)}.jkz-nav-dark .jkz-nav-link:hover,.jkz-nav-primary .jkz-nav-link:hover{background:rgba(255,255,255,.12);color:#fff}.jkz-tabs-bar{display:flex}.jkz-tabs-default{border-bottom:2px solid #e2e8f0}.jkz-tabs-pills{background:#f1f5f9;border-radius:12px;padding:4px;gap:3px}.jkz-tab{padding:9px 18px;border:none;cursor:pointer;font-size:14px;font-weight:600;font-family:inherit;transition:all .15s;background:transparent;border-radius:0}.jkz-tabs-default .jkz-tab{color:#64748b;border-bottom:2px solid transparent;margin-bottom:-2px}.jkz-tabs-default .jkz-tab:first-child{color:#7c6fff;border-bottom-color:#7c6fff}.jkz-tabs-pills .jkz-tab{border-radius:8px;color:#64748b}.jkz-tabs-pills .jkz-tab:first-child{background:#fff;color:#7c6fff;box-shadow:0 2px 8px rgba(0,0,0,.08)}.jkz-breadcrumb{display:flex;align-items:center;gap:6px;flex-wrap:wrap;font-size:14px}.jkz-bc-link{color:#7c6fff;text-decoration:none;font-weight:500;display:flex;align-items:center;gap:6px}.jkz-bc-current{color:#0f172a;font-weight:600}.jkz-bc-sep{color:#cbd5e1;font-size:12px}.jkz-pag{display:flex;align-items:center;gap:4px;flex-wrap:wrap}.jkz-pag-btn{min-width:36px;height:36px;padding:0 10px;display:flex;align-items:center;justify-content:center;border:1px solid #e2e8f0;border-radius:8px;font-size:13px;font-weight:600;color:#374151;background:#fff;cursor:pointer;transition:all .15s;font-family:inherit}.jkz-pag-btn:hover{border-color:#7c6fff;color:#7c6fff}.jkz-pag-btn.active{background:#7c6fff;border-color:#7c6fff;color:#fff}.jkz-pag-btn.disabled{opacity:.4;cursor:not-allowed}.jkz-timeline{position:relative;padding-left:28px}.jkz-timeline::before{content:'';position:absolute;left:9px;top:8px;bottom:8px;width:2px;background:#e2e8f0}.jkz-tl-item{position:relative;padding-bottom:24px}.jkz-tl-item:last-child{padding-bottom:0}.jkz-tl-dot{position:absolute;left:-22px;width:16px;height:16px;border-radius:50%;background:#7c6fff;border:3px solid #fff;box-shadow:0 0 0 2px #7c6fff;top:2px}.jkz-tl-date{font-size:11px;font-weight:700;color:#94a3b8;margin-bottom:4px;text-transform:uppercase;letter-spacing:.5px}.jkz-tl-title{font-size:15px;font-weight:700;color:#0f172a;margin-bottom:4px}.jkz-tl-desc{font-size:13px;color:#64748b;line-height:1.6}.jkz-searchbar{display:flex;align-items:center;background:#fff;border:1.5px solid #d1d5db;border-radius:10px;overflow:hidden;transition:border-color .15s,box-shadow .15s}.jkz-searchbar:focus-within{border-color:#7c6fff;box-shadow:0 0 0 3px rgba(124,111,255,.15)}.jkz-search-icon{padding:0 12px;color:#9ca3af;font-size:16px;flex-shrink:0}.jkz-search-input{flex:1;padding:10px 0;border:none;outline:none;font-size:14px;color:#1f2937;font-family:inherit;background:transparent}.jkz-search-input::placeholder{color:#9ca3af}.jkz-search-btn{padding:9px 18px;background:#7c6fff;border:none;color:#fff;font-size:14px;font-weight:600;cursor:pointer;font-family:inherit}.jkz-canvas-item{position:relative;margin-bottom:8px;border:2px solid transparent;border-radius:10px;cursor:pointer;transition:border-color .15s;padding:2px}.jkz-canvas-item:hover{border-color:rgba(124,111,255,.35)}.jkz-canvas-item.sel{border-color:#7c6fff;box-shadow:0 0 0 3px rgba(124,111,255,.15)}.jkz-ctrl{position:absolute;top:-12px;right:4px;display:none;gap:3px;z-index:10}.jkz-canvas-item:hover .jkz-ctrl,.jkz-canvas-item.sel .jkz-ctrl{display:flex}.jkz-ctrl-btn{background:#7c6fff;border:none;color:#fff;border-radius:5px;padding:2px 7px;font-size:11px;font-weight:700;cursor:pointer;font-family:inherit}.jkz-ctrl-btn:hover{background:#5f4ee0}.jkz-ctrl-btn.del{background:#ef4444}.jkz-ctrl-btn.del:hover{background:#dc2626}`;

// COMPONENT DEFINITIONS
const COMP_DEFS = {
  button:{cat:'Basic',icon:'üî≤',label:'Button',
    def:{text:'Click Me',variant:'primary',size:'md',fullWidth:false,rounded:false},
    props:[{k:'text',l:'Label',t:'text'},{k:'variant',l:'Variant',t:'sel',o:['primary','secondary','outline','ghost','danger','success','warning','dark','link']},{k:'size',l:'Size',t:'sel',o:['xs','sm','md','lg','xl']},{k:'fullWidth',l:'Full Width',t:'bool'},{k:'rounded',l:'Pill Shape',t:'bool'}],
    render:(p)=>`<button class="jkz-btn jkz-btn-${p.variant} jkz-btn-${p.size}${p.fullWidth?' jkz-fw':''}${p.rounded?' jkz-pill':''}">${p.text||'Button'}</button>`},
  badge:{cat:'Basic',icon:'üè∑',label:'Badge',
    def:{text:'New',variant:'primary',size:'md',rounded:false},
    props:[{k:'text',l:'Label',t:'text'},{k:'variant',l:'Variant',t:'sel',o:['primary','success','warning','danger','info','dark','neutral']},{k:'size',l:'Size',t:'sel',o:['sm','md','lg']},{k:'rounded',l:'Pill Shape',t:'bool'}],
    render:(p)=>`<span class="jkz-badge jkz-badge-${p.variant} jkz-badge-${p.size||'md'}${p.rounded?' jkz-pill':''}">${p.text||'Badge'}</span>`},
  alert:{cat:'Basic',icon:'üîî',label:'Alert',
    def:{title:'Note',message:'This is an informational alert.',type:'info',showTitle:true},
    props:[{k:'title',l:'Title',t:'text'},{k:'message',l:'Message',t:'text'},{k:'type',l:'Type',t:'sel',o:['info','success','warning','error']},{k:'showTitle',l:'Show Title',t:'bool'}],
    render:(p)=>{const icons={info:'‚ÑπÔ∏è',success:'‚úÖ',warning:'‚ö†Ô∏è',error:'‚ùå'};return `<div class="jkz-alert jkz-alert-${p.type}"><span class="jkz-alert-icon">${icons[p.type]||''}</span><div class="jkz-alert-body">${p.showTitle&&p.title?`<div class="jkz-alert-title">${p.title}</div>`:''}${p.message||''}</div></div>`;}},
  divider:{cat:'Basic',icon:'‚ûñ',label:'Divider',
    def:{text:'',style:'solid',thick:false},
    props:[{k:'text',l:'Label (optional)',t:'text'},{k:'style',l:'Style',t:'sel',o:['solid','dashed','dotted']},{k:'thick',l:'Thick Line',t:'bool'}],
    render:(p)=>`<div class="jkz-divider${p.style!=='solid'?' '+p.style:''}${p.thick?' thick':''}">${p.text||''}</div>`},
  spinner:{cat:'Basic',icon:'‚≠ï',label:'Spinner',
    def:{size:'md'},
    props:[{k:'size',l:'Size',t:'sel',o:['sm','md','lg','xl']}],
    render:(p)=>`<div style="display:flex;justify-content:center;padding:10px"><div class="jkz-spinner jkz-spinner-${p.size}"></div></div>`},
  avatar:{cat:'Basic',icon:'üë§',label:'Avatar',
    def:{initials:'AB',size:'md',shape:'circle',bg:'#7c6fff',status:''},
    props:[{k:'initials',l:'Initials',t:'text'},{k:'size',l:'Size',t:'sel',o:['sm','md','lg','xl']},{k:'shape',l:'Shape',t:'sel',o:['circle','rounded','square']},{k:'bg',l:'Background',t:'color'},{k:'status',l:'Status',t:'sel',o:['','online','offline','away','busy']}],
    render:(p)=>`<div class="jkz-avatar jkz-avatar-${p.size} ${p.shape}" style="background:${p.bg||'#7c6fff'}">${p.initials||'?'}${p.status?`<span class="jkz-status jkz-status-${p.status}"></span>`:''}</div>`},
  heading:{cat:'Typography',icon:'üî†',label:'Heading',
    def:{text:'Page Heading',level:'h2',color:'#0f172a',align:'left',gradient:false},
    props:[{k:'text',l:'Text',t:'text'},{k:'level',l:'Level',t:'sel',o:['h1','h2','h3','h4','h5','h6']},{k:'color',l:'Color',t:'color'},{k:'align',l:'Align',t:'sel',o:['left','center','right']},{k:'gradient',l:'Gradient Text',t:'bool'}],
    render:(p)=>{const style=p.gradient?'background:linear-gradient(135deg,#7c6fff,#ff6b9d);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text':`color:${p.color||'#0f172a'}`;return `<${p.level||'h2'} class="jkz-h jkz-${p.level||'h2'}" style="${style};text-align:${p.align||'left'}">${p.text||'Heading'}</${p.level||'h2'}>`;} },
  textblock:{cat:'Typography',icon:'üìù',label:'Text Block',
    def:{content:'This is a paragraph of text. Edit the content to change what appears here.',size:'md',color:'#475569',align:'left'},
    props:[{k:'content',l:'Content',t:'ta'},{k:'size',l:'Size',t:'sel',o:['sm','md','lg']},{k:'color',l:'Color',t:'color'},{k:'align',l:'Align',t:'sel',o:['left','center','right']}],
    render:(p)=>{const fs={sm:'0.875rem',md:'1rem',lg:'1.125rem'}[p.size||'md'];return `<p class="jkz-text" style="font-size:${fs};color:${p.color||'#475569'};text-align:${p.align||'left'}">${p.content||'Text block'}</p>`;}},
  blockquote:{cat:'Typography',icon:'üí¨',label:'Blockquote',
    def:{quote:'The best way to predict the future is to create it.',author:'Peter Drucker'},
    props:[{k:'quote',l:'Quote',t:'ta'},{k:'author',l:'Author',t:'text'}],
    render:(p)=>`<blockquote class="jkz-blockquote">"${p.quote||'Quote'}"${p.author?`<cite>‚Äî ${p.author}</cite>`:''}</blockquote>`},
  codeblock:{cat:'Typography',icon:'üíª',label:'Code Block',
    def:{code:'const greeting = "Hello, World!";\nconsole.log(greeting);',lang:'JavaScript'},
    props:[{k:'lang',l:'Language Label',t:'text'},{k:'code',l:'Code',t:'ta'}],
    render:(p)=>`<div class="jkz-code-block"><div class="jkz-code-hdr"><div class="jkz-code-dots"><div class="jkz-code-dot" style="background:#ff5f56"></div><div class="jkz-code-dot" style="background:#ffbd2e"></div><div class="jkz-code-dot" style="background:#27c93f"></div></div><span>${p.lang||'Code'}</span></div><pre class="jkz-code-pre"><code>${escHtml(p.code||'// code here')}</code></pre></div>`},
  textinput:{cat:'Form',icon:'‚úèÔ∏è',label:'Text Input',
    def:{label:'Email Address',placeholder:'Enter your email',type:'email',required:false,helper:'',error:false},
    props:[{k:'label',l:'Label',t:'text'},{k:'placeholder',l:'Placeholder',t:'text'},{k:'type',l:'Type',t:'sel',o:['text','email','password','number','tel','url']},{k:'required',l:'Required',t:'bool'},{k:'error',l:'Error State',t:'bool'},{k:'helper',l:'Helper Text',t:'text'}],
    render:(p)=>`<div class="jkz-field"><label class="jkz-label${p.required?' req':''}">${p.label||'Label'}</label><input class="jkz-input${p.error?' err':''}" type="${p.type||'text'}" placeholder="${p.placeholder||''}">${p.helper?`<span class="jkz-helper${p.error?' err':''}">${p.helper}</span>`:''}</div>`},
  textarea:{cat:'Form',icon:'üìÑ',label:'Textarea',
    def:{label:'Message',placeholder:'Type your message here...',rows:4,helper:''},
    props:[{k:'label',l:'Label',t:'text'},{k:'placeholder',l:'Placeholder',t:'text'},{k:'rows',l:'Rows',t:'num',min:2,max:12},{k:'helper',l:'Helper Text',t:'text'}],
    render:(p)=>`<div class="jkz-field"><label class="jkz-label">${p.label||'Label'}</label><textarea class="jkz-textarea" rows="${p.rows||4}" placeholder="${p.placeholder||''}"></textarea>${p.helper?`<span class="jkz-helper">${p.helper}</span>`:''}</div>`},
  selectfield:{cat:'Form',icon:'üîΩ',label:'Select',
    def:{label:'Country',placeholder:'Choose an option',options:'Option 1,Option 2,Option 3',helper:''},
    props:[{k:'label',l:'Label',t:'text'},{k:'placeholder',l:'Placeholder',t:'text'},{k:'options',l:'Options (comma-sep)',t:'text'},{k:'helper',l:'Helper Text',t:'text'}],
    render:(p)=>{const opts=(p.options||'Option 1,Option 2').split(',').map(o=>`<option>${o.trim()}</option>`).join('');return `<div class="jkz-field"><label class="jkz-label">${p.label||'Label'}</label><select class="jkz-select"><option value="" disabled selected>${p.placeholder||'Select...'}</option>${opts}</select>${p.helper?`<span class="jkz-helper">${p.helper}</span>`:''}</div>`;}},
  checkbox:{cat:'Form',icon:'‚òëÔ∏è',label:'Checkbox',
    def:{label:'I agree to the terms and conditions',checked:false,helper:''},
    props:[{k:'label',l:'Label',t:'text'},{k:'checked',l:'Checked',t:'bool'},{k:'helper',l:'Helper Text',t:'text'}],
    render:(p)=>`<div style="display:flex;flex-direction:column;gap:5px"><label class="jkz-check-wrap"><div class="jkz-check-box${p.checked?' on':''}">${p.checked?'‚úì':''}</div><span class="jkz-opt-label">${p.label||'Checkbox label'}</span></label>${p.helper?`<span class="jkz-helper" style="padding-left:28px">${p.helper}</span>`:''}</div>`},
  radiogroup:{cat:'Form',icon:'üîò',label:'Radio Group',
    def:{legend:'Choose one',options:'Option A,Option B,Option C',selectedIndex:0},
    props:[{k:'legend',l:'Legend',t:'text'},{k:'options',l:'Options (comma-sep)',t:'text'},{k:'selectedIndex',l:'Selected Index',t:'num',min:0,max:10}],
    render:(p)=>{const opts=(p.options||'A,B,C').split(',');const radios=opts.map((o,i)=>`<label class="jkz-radio-wrap"><div class="jkz-radio-dot${i===parseInt(p.selectedIndex||0)?' on':''}">${i===parseInt(p.selectedIndex||0)?'<div class="jkz-radio-inner"></div>':''}</div><span class="jkz-opt-label">${o.trim()}</span></label>`).join('');return `<fieldset style="border:none;padding:0"><legend style="font-size:13px;font-weight:600;color:#374151;margin-bottom:10px;display:block">${p.legend||'Select'}</legend><div style="display:flex;flex-direction:column;gap:8px">${radios}</div></fieldset>`;}},
  toggle:{cat:'Form',icon:'üîÄ',label:'Toggle',
    def:{label:'Enable notifications',checked:true},
    props:[{k:'label',l:'Label',t:'text'},{k:'checked',l:'Checked',t:'bool'}],
    render:(p)=>`<label class="jkz-tog-wrap"><div class="jkz-tog-track ${p.checked?'on':'off'}"><div class="jkz-tog-thumb"></div></div><span class="jkz-tog-label">${p.label||'Toggle'}</span></label>`},
  slider:{cat:'Form',icon:'üéö',label:'Range Slider',
    def:{label:'Volume',value:65,min:0,max:100,step:1},
    props:[{k:'label',l:'Label',t:'text'},{k:'value',l:'Value',t:'num',min:0,max:100},{k:'min',l:'Min',t:'num'},{k:'max',l:'Max',t:'num'},{k:'step',l:'Step',t:'num',min:1}],
    render:(p)=>`<div class="jkz-range-wrap"><div class="jkz-range-hdr"><span class="jkz-range-lbl">${p.label||'Slider'}</span><span class="jkz-range-val">${p.value||50}</span></div><input type="range" class="jkz-range" min="${p.min||0}" max="${p.max||100}" step="${p.step||1}" value="${p.value||50}"></div>`},
  searchbar:{cat:'Form',icon:'üîç',label:'Search Bar',
    def:{placeholder:'Search anything...',btnText:'Search',showBtn:true},
    props:[{k:'placeholder',l:'Placeholder',t:'text'},{k:'btnText',l:'Button Text',t:'text'},{k:'showBtn',l:'Show Button',t:'bool'}],
    render:(p)=>`<div class="jkz-searchbar"><span class="jkz-search-icon">üîç</span><input class="jkz-search-input" placeholder="${p.placeholder||'Search...'}">${p.showBtn?`<button class="jkz-search-btn">${p.btnText||'Search'}</button>`:''}</div>`},
  card:{cat:'Layout',icon:'üÉè',label:'Card',
    def:{title:'Card Title',body:'This is the card body. You can add any content here.',footer:'Card footer',variant:'default',showHeader:true,showFooter:true,showImage:false},
    props:[{k:'title',l:'Title',t:'text'},{k:'body',l:'Body Text',t:'ta'},{k:'footer',l:'Footer',t:'text'},{k:'variant',l:'Variant',t:'sel',o:['default','elevated','bordered','flat']},{k:'showHeader',l:'Show Header',t:'bool'},{k:'showFooter',l:'Show Footer',t:'bool'},{k:'showImage',l:'Show Image Placeholder',t:'bool'}],
    render:(p)=>`<div class="jkz-card jkz-card-${p.variant||'default'}">${p.showImage?'<div class="jkz-card-img">üì∑ Image Placeholder</div>':''}${p.showHeader!==false?`<div class="jkz-card-header">${p.title||'Card Title'}</div>`:''}<div class="jkz-card-body">${p.body||'Card body content.'}</div>${p.showFooter!==false?`<div class="jkz-card-footer">${p.footer||'Footer'}</div>`:''}</div>`},
  twocol:{cat:'Layout',icon:'‚¨õ‚¨õ',label:'Two Columns',
    def:{col1:'Left column content',col2:'Right column content',gap:16},
    props:[{k:'col1',l:'Left Content',t:'ta'},{k:'col2',l:'Right Content',t:'ta'},{k:'gap',l:'Gap (px)',t:'num',min:0,max:60}],
    render:(p)=>`<div class="jkz-grid jkz-grid-2" style="gap:${p.gap||16}px"><div class="jkz-grid-item">${p.col1||'Left column'}</div><div class="jkz-grid-item">${p.col2||'Right column'}</div></div>`},
  hero:{cat:'Layout',icon:'ü¶∏',label:'Hero Banner',
    def:{tag:'Welcome',title:'Build Something Amazing',subtitle:'A modern, clean hero section for your landing page.',cta:'Get Started',cta2:'Learn More',gradient:false},
    props:[{k:'tag',l:'Tag Line',t:'text'},{k:'title',l:'Title',t:'text'},{k:'subtitle',l:'Subtitle',t:'ta'},{k:'cta',l:'Primary CTA',t:'text'},{k:'cta2',l:'Secondary CTA',t:'text'},{k:'gradient',l:'Gradient Background',t:'bool'}],
    render:(p)=>`<section class="jkz-hero" style="background:${p.gradient?'linear-gradient(135deg,#faf7ff,#f0fdfa)':'#ffffff'}">${p.tag?`<div class="jkz-hero-tag">${p.tag}</div>`:''}<h1 class="jkz-hero-title" style="background:linear-gradient(135deg,#7c6fff,#ff6b9d);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text">${p.title||'Hero Title'}</h1><p class="jkz-hero-sub">${p.subtitle||'Hero subtitle text'}</p><div class="jkz-hero-acts">${p.cta?`<button class="jkz-btn jkz-btn-primary jkz-btn-md jkz-pill">${p.cta}</button>`:''} ${p.cta2?`<button class="jkz-btn jkz-btn-outline jkz-btn-md jkz-pill">${p.cta2}</button>`:''}</div></section>`},
  featurebox:{cat:'Layout',icon:'‚ú®',label:'Feature Box',
    def:{icon:'üöÄ',title:'Fast Performance',desc:'Optimized for speed and efficiency, delivering results in milliseconds.'},
    props:[{k:'icon',l:'Icon (emoji)',t:'text'},{k:'title',l:'Title',t:'text'},{k:'desc',l:'Description',t:'ta'}],
    render:(p)=>`<div class="jkz-feature"><div class="jkz-feature-icon">${p.icon||'‚≠ê'}</div><div><p class="jkz-feature-title">${p.title||'Feature Title'}</p><p class="jkz-feature-desc">${p.desc||'Feature description here.'}</p></div></div>`},
  pricing:{cat:'Layout',icon:'üí≥',label:'Pricing Card',
    def:{plan:'Pro',price:'$49',period:'/month',features:'Unlimited projects,Priority support,Custom domain,Advanced analytics',cta:'Get Started',featured:false,featuredLabel:'Most Popular'},
    props:[{k:'plan',l:'Plan Name',t:'text'},{k:'price',l:'Price',t:'text'},{k:'period',l:'Period',t:'text'},{k:'features',l:'Features (comma-sep)',t:'ta'},{k:'cta',l:'CTA Button',t:'text'},{k:'featured',l:'Featured',t:'bool'},{k:'featuredLabel',l:'Featured Label',t:'text'}],
    render:(p)=>{const feats=(p.features||'Feature 1,Feature 2').split(',').map(f=>`<li>${f.trim()}</li>`).join('');return `<div class="jkz-pricing${p.featured?' featured':''}">${p.featured&&p.featuredLabel?`<div class="jkz-pricing-badge">${p.featuredLabel}</div>`:''}<div class="jkz-pricing-plan">${p.plan||'Plan'}</div><div class="jkz-pricing-price">${p.price||'$0'}</div><div class="jkz-pricing-period">${p.period||'/mo'}</div><ul class="jkz-pricing-features">${feats}</ul><button class="jkz-btn jkz-btn-${p.featured?'primary':'outline'} jkz-btn-md jkz-fw jkz-pill">${p.cta||'Get Started'}</button></div>`;}},
  table:{cat:'Data',icon:'üìä',label:'Table',
    def:{headers:'Name,Role,Status,Date',rows:3,striped:true,hoverable:true,compact:false},
    props:[{k:'headers',l:'Headers (comma-sep)',t:'text'},{k:'rows',l:'Row Count',t:'num',min:1,max:8},{k:'striped',l:'Striped Rows',t:'bool'},{k:'hoverable',l:'Hover Effect',t:'bool'},{k:'compact',l:'Compact Size',t:'bool'}],
    render:(p)=>{const hdrs=(p.headers||'Col 1,Col 2,Col 3').split(',');const sampleData=[['Alice Johnson','Designer','Active','Jan 2024'],['Bob Smith','Developer','Active','Feb 2024'],['Carol White','Manager','Inactive','Mar 2024'],['David Lee','Designer','Active','Apr 2024'],['Eva Chen','Developer','Active','May 2024'],['Frank Moss','QA','Active','Jun 2024'],['Grace Liu','PM','Active','Jul 2024'],['Henry Park','DevOps','Inactive','Aug 2024']];const rows=Array.from({length:Math.min(parseInt(p.rows)||3,sampleData.length)},(_,i)=>`<tr>${hdrs.map((_,j)=>`<td>${sampleData[i][j]||`Cell ${j+1}`}</td>`).join('')}</tr>`).join('');return `<div class="jkz-tbl-wrap"><table class="jkz-table${p.striped?' striped':''}${p.hoverable?' hoverable':''}${p.compact?' compact':''}"><thead><tr>${hdrs.map(h=>`<th>${h.trim()}</th>`).join('')}</tr></thead><tbody>${rows}</tbody></table></div>`;}},
  progress:{cat:'Data',icon:'üìà',label:'Progress Bar',
    def:{label:'Completion',value:72,variant:'primary',size:'md',showLabel:true},
    props:[{k:'label',l:'Label',t:'text'},{k:'value',l:'Value (0-100)',t:'num',min:0,max:100},{k:'variant',l:'Color',t:'sel',o:['primary','success','warning','danger','gradient']},{k:'size',l:'Size',t:'sel',o:['xs','sm','md','lg']},{k:'showLabel',l:'Show Label',t:'bool'}],
    render:(p)=>{const v=Math.min(100,Math.max(0,parseInt(p.value)||0));return `<div class="jkz-prog-wrap jkz-prog-${p.variant||'primary'} jkz-prog-${p.size||'md'}">${p.showLabel!==false?`<div class="jkz-prog-hdr"><span>${p.label||'Progress'}</span><span class="jkz-prog-pct">${v}%</span></div>`:''}<div class="jkz-prog-track"><div class="jkz-prog-bar" style="width:${v}%"></div></div></div>`;}},
  statcard:{cat:'Data',icon:'üìâ',label:'Stat Card',
    def:{label:'Total Revenue',value:'$48,295',change:'+12.5%',changeType:'up',icon:'üí∞'},
    props:[{k:'label',l:'Label',t:'text'},{k:'value',l:'Value',t:'text'},{k:'change',l:'Change',t:'text'},{k:'changeType',l:'Change Type',t:'sel',o:['up','down','neutral']},{k:'icon',l:'Icon (emoji)',t:'text'}],
    render:(p)=>`<div class="jkz-stat">${p.icon?`<div style="font-size:28px;margin-bottom:12px">${p.icon}</div>`:''}<div class="jkz-stat-label">${p.label||'Metric'}</div><div class="jkz-stat-val">${p.value||'0'}</div>${p.change?`<span class="jkz-stat-change jkz-stat-${p.changeType||'neutral'}">${p.changeType==='up'?'‚Üë':p.changeType==='down'?'‚Üì':''}${p.change}</span>`:''}</div>`},
  timeline:{cat:'Data',icon:'üìÖ',label:'Timeline',
    def:{items:'Product launch ‚Äî Released version 1.0 ‚Äî Jan 2024|Team expanded ‚Äî Hired 5 engineers ‚Äî Mar 2024|Series A ‚Äî Funding closed ‚Äî Jun 2024'},
    props:[{k:'items',l:'Items (pipe-sep: title ‚Äî desc ‚Äî date)',t:'ta'}],
    render:(p)=>{const items=(p.items||'Event 1 ‚Äî Description ‚Äî Date').split('|').map(s=>{const [title,desc,date]=(s||'').split('‚Äî').map(x=>(x||'').trim());return `<div class="jkz-tl-item"><div class="jkz-tl-dot"></div>${date?`<div class="jkz-tl-date">${date}</div>`:''}<div class="jkz-tl-title">${title||'Event'}</div>${desc?`<div class="jkz-tl-desc">${desc}</div>`:''}</div>`;}).join('');return `<div class="jkz-timeline">${items}</div>`;}},
  navbar:{cat:'Navigation',icon:'üîù',label:'Navbar',
    def:{brand:'MyApp',links:'Home,About,Services,Contact',variant:'light',showBtn:true,btnText:'Sign Up'},
    props:[{k:'brand',l:'Brand Name',t:'text'},{k:'links',l:'Links (comma-sep)',t:'text'},{k:'variant',l:'Theme',t:'sel',o:['light','dark','primary','glass']},{k:'showBtn',l:'Show CTA Button',t:'bool'},{k:'btnText',l:'Button Text',t:'text'}],
    render:(p)=>{const links=(p.links||'Home,About').split(',').map(l=>`<button class="jkz-nav-link">${l.trim()}</button>`).join('');return `<nav class="jkz-nav jkz-nav-${p.variant||'light'}"><a class="jkz-nav-brand" href="#">${p.brand||'Brand'}</a><div class="jkz-nav-links">${links}${p.showBtn?`<button class="jkz-btn jkz-btn-primary jkz-btn-sm jkz-pill" style="margin-left:8px">${p.btnText||'Sign Up'}</button>`:''}</div></nav>`;}},
  tabs:{cat:'Navigation',icon:'üìë',label:'Tabs',
    def:{tabs:'Dashboard,Analytics,Settings,Profile',variant:'default'},
    props:[{k:'tabs',l:'Tabs (comma-sep)',t:'text'},{k:'variant',l:'Style',t:'sel',o:['default','pills']}],
    render:(p)=>{const tabList=(p.tabs||'Tab 1,Tab 2,Tab 3').split(',').map((t,i)=>`<button class="jkz-tab">${t.trim()}</button>`).join('');return `<div class="jkz-tabs-bar jkz-tabs-${p.variant||'default'}">${tabList}</div>`;}},
  breadcrumb:{cat:'Navigation',icon:'üçû',label:'Breadcrumb',
    def:{items:'Home,Products,Electronics,Phones',sep:'/'},
    props:[{k:'items',l:'Items (comma-sep)',t:'text'},{k:'sep',l:'Separator',t:'text'}],
    render:(p)=>{const items=(p.items||'Home,Page').split(',');const crumbs=items.map((item,i)=>{const isLast=i===items.length-1;return isLast?`<span class="jkz-bc-current">${item.trim()}</span>`:`<a class="jkz-bc-link" href="#">${item.trim()}</a><span class="jkz-bc-sep">${p.sep||'/'}</span>`;}).join('');return `<nav class="jkz-breadcrumb">${crumbs}</nav>`;}},
  pagination:{cat:'Navigation',icon:'üìñ',label:'Pagination',
    def:{pages:5,current:2,showPrev:true,showNext:true},
    props:[{k:'pages',l:'Total Pages',t:'num',min:1,max:20},{k:'current',l:'Current Page',t:'num',min:1,max:20},{k:'showPrev',l:'Show Prev',t:'bool'},{k:'showNext',l:'Show Next',t:'bool'}],
    render:(p)=>{const cur=parseInt(p.current)||1,total=parseInt(p.pages)||5;const btns=Array.from({length:total},(_,i)=>`<button class="jkz-pag-btn${i+1===cur?' active':''}">${i+1}</button>`).join('');return `<div class="jkz-pag">${p.showPrev?`<button class="jkz-pag-btn${cur===1?' disabled':''}">‚Äπ</button>`:''} ${btns} ${p.showNext?`<button class="jkz-pag-btn${cur===total?' disabled':''}">‚Ä∫</button>`:''}</div>`;}},
};

// HELPERS
function escHtml(s){return (s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');}
function toast(msg){const t=document.getElementById('toast');document.getElementById('toastMsg').textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2600);}
function esc(s){return (s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');}
function sanitize(s){return (s||'MyIntegration').replace(/[^a-zA-Z0-9_]/g,'').replace(/^[0-9]/,'_')||'MyIntegration';}
function apxStr(s){return (s||'').replace(/\\/g,'\\\\').replace(/'/g,"\\'").replace(/\r?\n/g,' ');}
function validateJson(str,elId){const el=document.getElementById(elId);if(!el) return null;if(!str.trim()){el.textContent='';return null;}try{const p=JSON.parse(str);el.style.color='var(--acc2)';el.textContent='‚úì Valid JSON';return p;}catch(e){el.style.color='var(--acc3)';el.textContent='‚úó '+e.message;return null;}}
function copyText(text,btn){const cb=()=>{if(btn){const o=btn.textContent;btn.textContent='‚úì';setTimeout(()=>btn.textContent=o,1800);}};if(navigator.clipboard)navigator.clipboard.writeText(text).then(cb);else{const ta=document.createElement('textarea');ta.value=text;document.body.appendChild(ta);ta.select();document.execCommand('copy');document.body.removeChild(ta);cb();}}
function copyBlock(id,btn){copyText(document.getElementById(id).textContent,btn);}

// PC / MOBILE SWITCH
function pcSwitchMode(m){
  ['apex','playground','builder'].forEach(v=>{const el=document.getElementById('pc-'+v);if(el)el.classList.toggle('hidden',v!==m);});
  ['pc-mApex','pc-mPlay','pc-mBuild'].forEach((id,i)=>{const el=document.getElementById(id);if(el)el.classList.toggle('active',['apex','playground','builder'][i]===m);});
  if(m==='builder'){blRenderPalette();blRefreshCanvas();}
}

function mSwitchMode(m){
  mCurrentMode=m;
  ['apex','playground','builder'].forEach(v=>{const el=document.getElementById('m-'+v);if(el)el.classList.toggle('hidden',v!==m);});
  ['m-nav-apex','m-nav-playground','m-nav-builder'].forEach((id,v2)=>{const el=document.getElementById(id);if(el)el.classList.toggle('active',['apex','playground','builder'][v2]===m);});
  document.getElementById('mRunBtn').classList.toggle('hidden',m!=='playground');
  if(m==='builder'){blRenderMPalette();blRefreshCanvas();}
  renderDrawer();
}

// DRAWER
function openDrawer(){renderDrawer();document.getElementById('drawer').classList.add('open');document.getElementById('drawerOverlay').classList.add('open');}
function closeDrawer(){document.getElementById('drawer').classList.remove('open');document.getElementById('drawerOverlay').classList.remove('open');}
function drawerNewAction(){closeDrawer();if(mCurrentMode==='apex')apexNew();else if(mCurrentMode==='playground')pgNew();}
function renderDrawer(){
  const title=document.getElementById('drawerTitle');
  const list=document.getElementById('drawerList');
  const newBtn=document.getElementById('drawerNewBtn');
  if(mCurrentMode==='builder'){title.textContent='UI Designer';newBtn.textContent='‚úï Clear Canvas';list.innerHTML=`<div class="drawer-empty">Use the Design tab to add &amp; manage UI components.</div>`;return;}
  if(mCurrentMode==='apex'){
    title.textContent='Integrations';newBtn.textContent='Ôºã New Integration';list.innerHTML='';
    if(!apexList.length){list.innerHTML='<div class="drawer-empty">No integrations yet.</div>';return;}
    apexList.forEach(r=>{const d=document.createElement('div');d.className='drawer-item'+(r.id===document.getElementById('apexId').value?' active':'');d.innerHTML=`<div class="drawer-item-meta" onclick="apexLoad('${r.id}');closeDrawer()"><div class="drawer-item-name"><span class="mbadge m-${r.method}">${r.method}</span> ${esc(r.name)}</div><div class="drawer-item-sub">${esc((r.url||'').substring(0,30))}${(r.url||'').length>30?'‚Ä¶':''}</div></div><button class="drawer-item-del" onclick="apexDelete('${r.id}',event)">‚úï</button>`;list.appendChild(d);});
  } else {
    title.textContent='Projects';newBtn.textContent='Ôºã New Project';list.innerHTML='';
    if(!pgProjects.length){list.innerHTML='<div class="drawer-empty">No projects yet.</div>';return;}
    pgProjects.forEach(p=>{const d=document.createElement('div');d.className='drawer-item'+(p.id===pgCurrentId?' active':'');d.innerHTML=`<div class="drawer-item-meta" onclick="pgLoad('${p.id}');closeDrawer()"><div class="drawer-item-name">${esc(p.name)}</div><div class="drawer-item-sub">${p.updated||''}</div></div><button class="drawer-item-del" onclick="pgDeleteProject('${p.id}',event)">‚úï</button>`;list.appendChild(d);});
  }
}
function mFabAction(){if(mCurrentMode==='apex')apexNew();else if(mCurrentMode==='playground')pgNew();toast(mCurrentMode==='apex'?'Ôºã New integration':mCurrentMode==='playground'?'Ôºã New project':'Use Add tab to insert components');}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê APEX ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function aG(pc,mob){const pEl=document.getElementById(pc),mEl=document.getElementById(mob);if(IS_MOBILE)return mEl?mEl.value:(pEl?pEl.value:'');return pEl?pEl.value:(mEl?mEl.value:'');}
function aCb(pc,mob){const pEl=document.getElementById(pc),mEl=document.getElementById(mob);if(IS_MOBILE)return mEl?mEl.checked:(pEl?pEl.checked:false);return pEl?pEl.checked:(mEl?mEl.checked:false);}
function aSet(pc,mob,val){const pEl=document.getElementById(pc),mEl=document.getElementById(mob);if(pEl)pEl.value=val;if(mEl)mEl.value=val;}
function aCbSet(pc,mob,val){const pEl=document.getElementById(pc),mEl=document.getElementById(mob);if(pEl)pEl.checked=val;if(mEl)mEl.checked=val;['Row','Row'].forEach((s,i)=>{const id=[pc,mob][i]+s;const row=document.getElementById(id);if(row)row.classList.toggle('checked',val);});}
function apexToggleCb(id,row){const cb=document.getElementById(id);cb.checked=!cb.checked;row.classList.toggle('checked',cb.checked);}
function apexAuthUI(){const auth=IS_MOBILE?document.getElementById('mAuth').value:document.getElementById('aAuth').value;const show=auth==='Bearer'||auth==='ApiKey';const lbl=auth==='Bearer'?'Bearer Token Value':'API Key Value';['aAuthValBox','mAuthValBox'].forEach(id=>{const el=document.getElementById(id);if(el)el.classList.toggle('hidden',!show);});['aAuthLbl','mAuthLbl'].forEach(id=>{const el=document.getElementById(id);if(el)el.textContent=lbl;});}
function apexToggleBody(){const m=IS_MOBILE?(document.getElementById('mM')||{}).value:(document.getElementById('aM')||{}).value;const has=['POST','PUT','PATCH'].includes(m);['aBodyBox','mBodyBox'].forEach(id=>{const el=document.getElementById(id);if(el)el.classList.toggle('hidden',!has);});}
function toggleTOBox(){const v=document.getElementById('aTO').checked;document.getElementById('aTOValBox').classList.toggle('hidden',!v);}
function mToggleTOBox(){const v=document.getElementById('mTO').checked;document.getElementById('mTOValBox').classList.toggle('hidden',!v);}
function apexAddHeader(k='',v=''){['aHdrCont','mHdrCont'].forEach(contId=>{const cont=document.getElementById(contId);if(!cont)return;const d=document.createElement('div');d.className='frow';d.style.marginBottom='6px';d.innerHTML=`<input class="fi h-key" style="flex:1;padding:7px 9px;font-size:11px;" placeholder="Key" value="${esc(k)}" oninput="apexPreview()"><input class="fi h-val" style="flex:1;padding:7px 9px;font-size:11px;" placeholder="Value" value="${esc(v)}" oninput="apexPreview()"><button style="background:transparent;border:none;color:var(--text3);padding:5px 7px;cursor:pointer;font-size:12px;" onclick="this.parentElement.remove();apexPreview()">‚úï</button>`;cont.appendChild(d);});apexPreview();}
function apexGetHeaders(){const cont=IS_MOBILE?document.getElementById('mHdrCont'):document.getElementById('aHdrCont');if(!cont)return[];const keys=cont.querySelectorAll('.h-key'),vals=cont.querySelectorAll('.h-val');let r=[];for(let i=0;i<keys.length;i++)if(keys[i].value.trim())r.push({k:keys[i].value,v:vals[i].value});return r;}
function pcApexTab(tab,btn){document.querySelectorAll('#pc-form-scroll .tab-btn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');['basic','headers','body','options'].forEach(t=>{const el=document.getElementById('pct-'+t);if(el)el.classList.toggle('hidden',t!==tab);});}
function mApexTab(tab,btn){document.querySelectorAll('.m-section-tabs .m-stab').forEach(b=>b.classList.remove('active'));btn.classList.add('active');['basic','headers','body','options'].forEach(t=>{const el=document.getElementById('mt-'+t);if(el)el.classList.toggle('hidden',t!==tab);});}
function showApexCode(){apexPreview();document.getElementById('apexPanelWrap').classList.add('show-code');}
function hideApexCode(){document.getElementById('apexPanelWrap').classList.remove('show-code');}
function pcApexCodeTab(tab,btn){document.querySelectorAll('.ctab').forEach(b=>b.classList.remove('active'));btn.classList.add('active');['pc-ab1','pc-ab2','pc-ab3'].forEach((id,i)=>{const el=document.getElementById(id);if(el)el.classList.toggle('hidden',tab!=='all'&&tab!==['main','mock','test'][i]);});}
function mApexCodeTab(tab,btn){document.querySelectorAll('.m-code-tabs .m-ctab').forEach(b=>b.classList.remove('active'));btn.classList.add('active');['m-ab1','m-ab2','m-ab3'].forEach((id,i)=>{const el=document.getElementById(id);if(el)el.classList.toggle('hidden',tab!=='all'&&tab!==['main','mock','test'][i]);});}
function apexNew(){const id=Date.now().toString();document.getElementById('apexId').value=id;aSet('aC','mC','MyIntegrationService');aSet('aUrl','mUrl','https://api.example.com/v1/data');aSet('aM','mM','GET');aSet('aAuth','mAuth','None');aSet('aAuthVal','mAuthVal','');aSet('aBody','mBody','');aSet('aRes','mRes','{\n  "status": "success",\n  "recordId": 123\n}');aSet('aMethod','mMethod','executeCallout');aSet('aTOVal','mTOVal','120000');['async','Log','Retry','TO','Ser'].forEach(n=>{['a'+n,'m'+n].forEach((id,i)=>{const el=document.getElementById(id);if(el){el.checked=n==='Log';const row=document.getElementById(id+'Row');if(row)row.classList.toggle('checked',n==='Log');}});});const pcH=document.getElementById('aHdrCont');if(pcH)pcH.innerHTML='';const mH=document.getElementById('mHdrCont');if(mH)mH.innerHTML='';apexAddHeader('Content-Type','application/json');apexAddHeader('Accept','application/json');['aTOValBox','mTOValBox','aAuthValBox','mAuthValBox'].forEach(id=>{const el=document.getElementById(id);if(el)el.classList.add('hidden');});hideApexCode();apexPreview();apexRenderList();}
function apexSave(){const rec={id:document.getElementById('apexId').value,name:aG('aC','mC').trim()||'MyIntegrationService',url:aG('aUrl','mUrl'),method:aG('aM','mM'),auth:aG('aAuth','mAuth'),authVal:aG('aAuthVal','mAuthVal'),headers:apexGetHeaders(),body:aG('aBody','mBody'),res:aG('aRes','mRes'),isAsync:aCb('aAsync','mAsync'),log:aCb('aLog','mLog'),retry:aCb('aRetry','mRetry'),timeout:aCb('aTO','mTO'),toVal:aG('aTOVal','mTOVal'),mName:aG('aMethod','mMethod')||'executeCallout',ser:aCb('aSer','mSer')};const idx=apexList.findIndex(i=>i.id===rec.id);if(idx>-1)apexList[idx]=rec;else apexList.push(rec);localStorage.setItem('jamKz_apex',JSON.stringify(apexList));apexRenderList();renderDrawer();toast('‚úì Integration saved!');}
function apexLoad(id){const r=apexList.find(i=>i.id===id);if(!r)return;document.getElementById('apexId').value=r.id;aSet('aC','mC',r.name);aSet('aUrl','mUrl',r.url);aSet('aM','mM',r.method);aSet('aAuth','mAuth',r.auth);aSet('aAuthVal','mAuthVal',r.authVal||'');aSet('aBody','mBody',r.body||'');aSet('aRes','mRes',r.res||'');aSet('aMethod','mMethod',r.mName||'executeCallout');aSet('aTOVal','mTOVal',r.toVal||'120000');aCbSet('aAsync','mAsync',!!r.isAsync);aCbSet('aLog','mLog',r.log!==false);aCbSet('aRetry','mRetry',!!r.retry);aCbSet('aTO','mTO',!!r.timeout);aCbSet('aSer','mSer',!!r.ser);const pcH=document.getElementById('aHdrCont');if(pcH)pcH.innerHTML='';const mH=document.getElementById('mHdrCont');if(mH)mH.innerHTML='';(r.headers||[]).forEach(h=>apexAddHeader(h.k,h.v));document.getElementById('aTOValBox').classList.toggle('hidden',!r.timeout);const mTOB=document.getElementById('mTOValBox');if(mTOB)mTOB.classList.toggle('hidden',!r.timeout);apexAuthUI();apexToggleBody();apexPreview();apexRenderList();renderDrawer();}
function apexDelete(id,e){e.stopPropagation();if(!confirm('Delete this integration?'))return;apexList=apexList.filter(i=>i.id!==id);localStorage.setItem('jamKz_apex',JSON.stringify(apexList));apexNew();renderDrawer();}
function apexRenderList(){const list=document.getElementById('pc-apex-list');if(!list)return;const curId=document.getElementById('apexId').value;list.innerHTML='';if(!apexList.length){list.innerHTML='<div class="sb-empty">No integrations yet.</div>';return;}apexList.forEach(r=>{const d=document.createElement('div');d.className='sb-item'+(r.id===curId?' active':'');d.innerHTML=`<div class="sb-item-meta" onclick="apexLoad('${r.id}')"><div class="sb-item-name"><span class="mbadge m-${r.method}">${r.method}</span> ${esc(r.name)}</div><div class="sb-item-sub">${esc((r.url||'').substring(0,28))}${(r.url||'').length>28?'‚Ä¶':''}</div></div><button class="sb-del" onclick="apexDelete('${r.id}',event)">‚úï</button>`;list.appendChild(d);});}
function apexCopyAll(){const all=['pcCode1','pcCode2','pcCode3'].map(i=>{const el=document.getElementById(i)||document.getElementById(i.replace('pc','m'));return el?el.textContent:'';}).join('\n\n//‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n\n');copyText(all);toast('‚úì All classes copied');}
function apexDownload(){const name=sanitize(aG('aC','mC'));[['pcCode1',name+'.cls'],['pcCode2',name+'Mock.cls'],['pcCode3',name+'Test.cls']].forEach(([id,fn])=>{const el=document.getElementById(id)||document.getElementById(id.replace('pc','m'));if(!el)return;const b=new Blob([el.textContent],{type:'text/plain'});const a=document.createElement('a');a.href=URL.createObjectURL(b);a.download=fn;a.click();URL.revokeObjectURL(a.href);});toast('‚¨á Downloaded 3 .cls files');}
function apexWrapper(json,name){if(!json.trim())return '';try{const obj=JSON.parse(json);if(typeof obj!=='object'||Array.isArray(obj))return '';let c=`\n    // ‚îÄ‚îÄ‚îÄ Auto-Generated Wrapper ‚îÄ‚îÄ‚îÄ\n    public class ${name}Wrapper {\n`;for(let k in obj){const v=obj[k];let t='String';if(typeof v==='number')t=Number.isInteger(v)?'Integer':'Decimal';else if(typeof v==='boolean')t='Boolean';else if(Array.isArray(v))t='List<Object>';else if(typeof v==='object'&&v!==null)t='Map<String, Object>';c+=`        @AuraEnabled public ${t} ${k};\n`;}return c+`    }\n`;}catch(e){return '\n    // ‚ö† Invalid JSON - wrapper skipped.\n';}}
function apexPreview(){const name=sanitize(aG('aC','mC'));let url=(aG('aUrl','mUrl')||'').trim();const meth=aG('aM','mM');const mName=(aG('aMethod','mMethod')||'executeCallout').replace(/\s+/g,'')||'executeCallout';const isAsy=aCb('aAsync','mAsync');const auth=aG('aAuth','mAuth');const aVal=aG('aAuthVal','mAuthVal');const hdrs=apexGetHeaders();const body=aG('aBody','mBody');const res=aG('aRes','mRes');const log=aCb('aLog','mLog');const retry=aCb('aRetry','mRetry');const setTO=aCb('aTO','mTO');const toMs=aG('aTOVal','mTOVal')||'120000';const ser=aCb('aSer','mSer');validateJson(res,'aResStatus');validateJson(res,'mResStatus');if(['POST','PUT','PATCH'].includes(meth)){validateJson(body,'aBodyStatus');}if(auth==='NamedCredential'&&url&&!url.includes('callout:')){const m=url.match(/https?:\/\/[^/]+(\/.*)/);url='callout:My_Named_Credential'+(m?m[1]:'');}let autoH=[];if(auth==='Bearer')autoH.push({k:'Authorization',v:`Bearer ${aVal||'{!$Credential.Password}'}`});if(auth==='ApiKey')autoH.push({k:'X-Api-Key',v:aVal||'{!$Credential.Password}'});const allH=[...autoH,...hdrs];
let c=`/**\n * @class       ${name}\n * @description HTTP callout: ${meth} ${url||'endpoint'}\n * @generated   Jam by Kz v2.0\n */\npublic with sharing class ${name} {\n\n`;if(retry)c+=`    private static final Integer MAX_RETRIES = 3;\n\n`;if(isAsy)c+=`    @future(callout=true)\n`;c+=`    public static void ${mName}() {\n`;if(retry){c+=`        Integer attempts = 0;\n        while (attempts <= MAX_RETRIES) {\n            try {\n                handleResponse(new Http().send(buildRequest()));\n                break;\n            } catch (CalloutException e) {\n                if (++attempts > MAX_RETRIES) { System.debug(LoggingLevel.ERROR, '${name}: '+e.getMessage()); throw e; }\n            }\n        }\n    }\n\n    private static HttpRequest buildRequest() {\n`;}else{c+=`        Http http = new Http();\n`;}c+=`        HttpRequest req = new HttpRequest();\n        req.setEndpoint('${apxStr(url)}');\n        req.setMethod('${meth}');\n`;if(setTO)c+=`        req.setTimeout(${toMs});\n`;c+=`\n`;allH.forEach(h=>{c+=`        req.setHeader('${apxStr(h.k)}', '${apxStr(h.v)}');\n`;});if(['POST','PUT','PATCH'].includes(meth)&&body.trim()){c+=`\n`;if(ser)c+=`        req.setBody(JSON.serialize(new ${name}RequestWrapper()));\n`;else c+=`        req.setBody('${apxStr(body)}');\n`;}if(retry){c+=`        return req;\n    }\n\n    private static void handleResponse(HttpResponse res) {\n`;}else{c+=`\n        try {\n            HttpResponse res = http.send(req);\n`;}c+=`            ${retry?'':'    '}if (res.getStatusCode() >= 200 && res.getStatusCode() < 300) {\n`;if(log)c+=`                System.debug(LoggingLevel.INFO, '${name}.${mName} | ${meth} | '+res.getStatusCode());\n`;if(res.trim())c+=`                ${name}Wrapper result = (${name}Wrapper) JSON.deserialize(res.getBody(), ${name}Wrapper.class);\n`;c+=`            ${retry?'':'    '}} else {\n                System.debug(LoggingLevel.WARN, '${name} | HTTP '+res.getStatusCode()+': '+res.getBody());\n            ${retry?'':'    '}}\n`;if(!retry)c+=`        } catch (Exception e) {\n            System.debug(LoggingLevel.ERROR, '${name}.${mName}: '+e.getMessage());\n            throw e;\n        }\n`;c+=`    }\n`;c+=apexWrapper(res,name);c+=`}`;
let m=`/**\n * @class       ${name}Mock\n * @generated   Jam by Kz v2.0\n */\n@isTest\npublic class ${name}Mock implements HttpCalloutMock {\n    private Integer statusCode;\n    private String responseBody;\n    public ${name}Mock() { this.statusCode=200; this.responseBody='${apxStr(res||'{}')}'; }\n    public ${name}Mock(Integer s, String b) { this.statusCode=s; this.responseBody=b; }\n    public HTTPResponse respond(HTTPRequest req) {\n        System.assertEquals('${meth}', req.getMethod(), '${name}Mock: method mismatch');\n        HttpResponse res = new HttpResponse();\n        res.setHeader('Content-Type','application/json');\n        res.setStatusCode(this.statusCode);\n        res.setBody(this.responseBody);\n        return res;\n    }\n}`;
let t=`/**\n * @class       ${name}Test\n * @coverage    Success ¬∑ HTTP Error ¬∑ Exception\n * @generated   Jam by Kz v2.0\n */\n@isTest\nprivate class ${name}Test {\n    @isTest static void test_${mName}_Success() {\n        Test.setMock(HttpCalloutMock.class, new ${name}Mock());\n        Test.startTest(); ${name}.${mName}(); Test.stopTest();\n    }\n    @isTest static void test_${mName}_HttpError() {\n        Test.setMock(HttpCalloutMock.class, new ${name}Mock(500,'{"error":"Internal Server Error"}'));\n        Test.startTest(); ${name}.${mName}(); Test.stopTest();\n    }\n    @isTest static void test_${mName}_Exception() {\n        Boolean threw = false;\n        Test.setMock(HttpCalloutMock.class, new ${name}Mock(0,''));\n        Test.startTest();\n        try { ${name}.${mName}(); } catch(Exception ex){ threw=true; }\n        Test.stopTest();\n    }\n}`;
['pcCode1','pcCode2','pcCode3'].forEach((id,i)=>{const el=document.getElementById(id);if(el)el.textContent=[c,m,t][i];});['pcFn1','pcFn2','pcFn3'].forEach((id,i)=>{const el=document.getElementById(id);if(el)el.textContent=[name+'.cls',name+'Mock.cls',name+'Test.cls'][i];});['mCode1','mCode2','mCode3'].forEach((id,i)=>{const el=document.getElementById(id);if(el)el.textContent=[c,m,t][i];});['mFn1','mFn2','mFn3'].forEach((id,i)=>{const el=document.getElementById(id);if(el)el.textContent=[name+'.cls',name+'Mock.cls',name+'Test.cls'][i];});const total=(c+m+t).split('\n').length;const slEl=document.getElementById('aStatLines');if(slEl)slEl.textContent=total+' lines';const smEl=document.getElementById('aStatMeth');if(smEl)smEl.textContent=meth;const feats=[];if(isAsy)feats.push('@future');if(retry)feats.push('retry');if(setTO)feats.push('timeout');if(auth!=='None')feats.push(auth.toLowerCase().replace('namedcredential','named-cred'));const sfEl=document.getElementById('aStatFeats');if(sfEl)sfEl.textContent=feats.length?feats.join(' ¬∑ '):'standard';}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PLAYGROUND ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function pgNew(){pgCurrentId=Date.now().toString();pgContents={html:PG_DEFAULT.html,css:PG_DEFAULT.css,js:PG_DEFAULT.js};pgCurrentLang='html';pgSetEditor('html');pgRun();pgRenderList();renderDrawer();}
function pgSetEditor(lang){pgCurrentLang=lang;const pcEd=document.getElementById('pcEditor'),mEd=document.getElementById('mEditor');if(pcEd){pcEd.value=pgContents[lang]||'';pgUpdateLineNums('pc');}if(mEd){mEd.value=pgContents[lang]||'';pgUpdateLineNums('m');}document.querySelectorAll('.pg-ftab').forEach(b=>b.classList.toggle('active',b.dataset.lang===lang));}
function pgSwitch(lang,btn){const pcEd=document.getElementById('pcEditor');if(pcEd)pgContents[pgCurrentLang]=pcEd.value;pgSetEditor(lang);document.querySelectorAll('.pg-ftab').forEach(b=>b.classList.remove('active'));if(btn)btn.classList.add('active');}
function mPgSwitch(lang,btn){const mEd=document.getElementById('mEditor');if(mEd)pgContents[pgCurrentLang]=mEd.value;const editWrap=document.getElementById('mEditorWrap'),prevWrap=document.getElementById('mPreviewWrap');if(lang==='preview'){editWrap.classList.add('hidden');prevWrap.classList.remove('hidden');pgRunMobile();}else{editWrap.classList.remove('hidden');prevWrap.classList.add('hidden');pgSetEditor(lang);}document.querySelectorAll('.pg-ltab').forEach(b=>b.classList.remove('active'));if(btn)btn.classList.add('active');}
function pgEditorInput(src){const ta=document.getElementById(src==='pc'?'pcEditor':'mEditor');pgContents[pgCurrentLang]=ta.value;pgUpdateLineNums(src);if(pgAutoRun&&src==='pc'){clearTimeout(pgAutoTimer);pgAutoTimer=setTimeout(pgRun,600);}}
function pgUpdateLineNums(src){const ta=document.getElementById(src==='pc'?'pcEditor':'mEditor'),lnEl=document.getElementById(src==='pc'?'pcLineNums':'mLineNums');if(!ta||!lnEl)return;const n=ta.value.split('\n').length;lnEl.textContent=Array.from({length:n},(_,i)=>i+1).join('\n');}
function syncScroll(src){const ta=document.getElementById(src==='pc'?'pcEditor':'mEditor'),ln=document.getElementById(src==='pc'?'pcLineNums':'mLineNums');if(ta&&ln)ln.scrollTop=ta.scrollTop;}
function pgKeydown(e,src){const ta=document.getElementById(src==='pc'?'pcEditor':'mEditor');if(e.key==='Tab'){e.preventDefault();const s=ta.selectionStart,end=ta.selectionEnd;ta.value=ta.value.substring(0,s)+'  '+ta.value.substring(end);ta.selectionStart=ta.selectionEnd=s+2;pgContents[pgCurrentLang]=ta.value;pgUpdateLineNums(src);return;}const pairs={'(':')','{':'}','[':']','"':'"',"'":"'"};if(pairs[e.key]){const s=ta.selectionStart,end=ta.selectionEnd;if(s===end){e.preventDefault();ta.value=ta.value.substring(0,s)+e.key+pairs[e.key]+ta.value.substring(end);ta.selectionStart=ta.selectionEnd=s+1;pgContents[pgCurrentLang]=ta.value;}}}
function buildPreviewDoc(){const consoleCap=`<script>(function(){var _c=window.console;function send(l,a){var s=Array.from(a).map(function(x){try{return typeof x==='object'?JSON.stringify(x):String(x);}catch(e){return String(x);}});window.parent.postMessage({source:'jamkz-console',level:l,args:s},'*');}window.console={log:function(){_c.log.apply(_c,arguments);send('log',arguments);},warn:function(){_c.warn.apply(_c,arguments);send('warn',arguments);},error:function(){_c.error.apply(_c,arguments);send('error',arguments);},info:function(){_c.info.apply(_c,arguments);send('info',arguments);}};window.addEventListener('error',function(e){send('error',[e.message+' (line '+e.lineno+')']);});})();<\/script>`;const html=pgContents.html,css=pgContents.css,js=pgContents.js;const isFull=/<!doctype|<html/i.test(html);if(isFull){let d=html;if(d.includes('</head>'))d=d.replace('</head>',`<style>${css}</style>\n${consoleCap}\n</head>`);else d=consoleCap+`<style>${css}</style>`+d;if(d.includes('</body>'))d=d.replace('</body>',`<script>${js}<\/script>\n</body>`);else d+=`<script>${js}<\/script>`;return d;}return `<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1">${consoleCap}<style>*{box-sizing:border-box}body{margin:0;padding:12px;font-family:Segoe UI,sans-serif;}${css}</style></head><body>${html}<script>${js}<\/script></body></html>`;}
function pgRun(){const pcEd=document.getElementById('pcEditor');if(pcEd)pgContents[pgCurrentLang]=pcEd.value;const btn=document.getElementById('pcRunBtn');if(btn){btn.classList.add('running');setTimeout(()=>btn.classList.remove('running'),400);}const f=document.getElementById('pcFrame');if(f)f.srcdoc=buildPreviewDoc();const ind=document.getElementById('pcInd');if(ind){ind.classList.add('show');setTimeout(()=>ind.classList.remove('show'),800);}}
function pgRunMobile(){const mEd=document.getElementById('mEditor');if(mEd)pgContents[pgCurrentLang]=mEd.value;const f=document.getElementById('mFrame');if(f)f.srcdoc=buildPreviewDoc();const ind=document.getElementById('mInd');if(ind){ind.classList.add('show');setTimeout(()=>ind.classList.remove('show'),1200);}}
function pgToggleAuto(){pgAutoRun=!pgAutoRun;document.getElementById('pcAutoTog').classList.toggle('on',pgAutoRun);toast(pgAutoRun?'‚ö° Auto-run on':'‚è∏ Auto-run off');}
function pgToggleConsole(){pcConsoleOpen=!pcConsoleOpen;document.getElementById('pcConsole').classList.toggle('open',pcConsoleOpen);}
function toggleMobileConsole(){mConsoleOpen=!mConsoleOpen;document.getElementById('mConsole').classList.toggle('open',mConsoleOpen);}
function addConsoleLog(src,level,args){const bodyId=src==='pc'?'pcConBody':'mConBody',cntId=src==='pc'?'pcConCnt':'mConCnt';const body=document.getElementById(bodyId),cnt=document.getElementById(cntId);if(!body)return;const empty=body.querySelector('.con-empty');if(empty)empty.remove();const line=document.createElement('div');line.className=`con-line ${level}`;line.innerHTML=`<span class="cl-t">${level.toUpperCase()}</span><span>${esc(args.join(' '))}</span>`;body.appendChild(line);body.scrollTop=body.scrollHeight;const n=body.querySelectorAll('.con-line').length;if(cnt){cnt.textContent=n;cnt.classList.toggle('err',level==='error');}if(level==='error'){if(src==='pc'&&!pcConsoleOpen)pgToggleConsole();if(src==='m'&&!mConsoleOpen)toggleMobileConsole();}}
function clearConsole(src){const bodyId=src==='pc'?'pcConBody':'mConBody',cntId=src==='pc'?'pcConCnt':'mConCnt';const body=document.getElementById(bodyId);if(body)body.innerHTML='<div class="con-empty">// Console cleared</div>';const cnt=document.getElementById(cntId);if(cnt){cnt.textContent='0';cnt.classList.remove('err');}}
window.addEventListener('message',function(e){if(e.data&&e.data.source==='jamkz-console'){const pcFrame=document.getElementById('pcFrame'),mFrame=document.getElementById('mFrame');const src=(e.source===pcFrame?.contentWindow)?'pc':'m';addConsoleLog(src,e.data.level,e.data.args);}});
function pgLayout(m){pgLayMode=m;document.querySelectorAll('.lay-btn').forEach(b=>b.classList.remove('active-lay'));document.getElementById('lay'+m.charAt(0).toUpperCase()+m.slice(1)).classList.add('active-lay');const ep=document.getElementById('edPane'),pp=document.getElementById('pvPane'),rh=document.getElementById('resizeH');ep.className='ed-pane';pp.className='pv-pane';if(rh)rh.style.display='none';if(m==='split'){ep.classList.add('half');pp.classList.add('half');if(rh)rh.style.display='';}if(m==='editor'){ep.classList.add('full');pp.classList.add('gone');}if(m==='preview'){ep.classList.add('gone');pp.classList.add('full');pgRun();}}
function pgFullscreen(){const f=document.getElementById('pcFrame');if(f.requestFullscreen)f.requestFullscreen();else if(f.webkitRequestFullscreen)f.webkitRequestFullscreen();}
function pgSave(){const pcEd=document.getElementById('pcEditor');if(pcEd)pgContents[pgCurrentLang]=pcEd.value;const mEd=document.getElementById('mEditor');if(mEd)pgContents[pgCurrentLang]=mEd.value;const existing=pgProjects.find(p=>p.id===pgCurrentId);const name=prompt('Project name:',existing?.name||'My Project')||'My Project';const proj={id:pgCurrentId||Date.now().toString(),name,html:pgContents.html,css:pgContents.css,js:pgContents.js,updated:new Date().toLocaleDateString()};pgCurrentId=proj.id;const idx=pgProjects.findIndex(p=>p.id===proj.id);if(idx>-1)pgProjects[idx]=proj;else pgProjects.push(proj);localStorage.setItem('jamKz_pg',JSON.stringify(pgProjects));pgRenderList();renderDrawer();toast('‚úì Project saved: '+name);}
function pgLoad(id){const p=pgProjects.find(p=>p.id===id);if(!p)return;pgCurrentId=id;pgContents={html:p.html||'',css:p.css||'',js:p.js||''};pgSetEditor(pgCurrentLang);pgRun();pgRunMobile();pgRenderList();renderDrawer();}
function pgDeleteProject(id,e){e.stopPropagation();if(!confirm('Delete this project?'))return;pgProjects=pgProjects.filter(p=>p.id!==id);localStorage.setItem('jamKz_pg',JSON.stringify(pgProjects));pgNew();}
function pgRenderList(){const list=document.getElementById('pc-pg-list');if(!list)return;list.innerHTML='';if(!pgProjects.length){list.innerHTML='<div style="padding:16px;text-align:center;color:var(--text3);font-size:11px;font-family:monospace;">No projects yet.</div>';return;}pgProjects.forEach(p=>{const hasCss=!!(p.css||'').trim(),hasJs=!!(p.js||'').trim();const d=document.createElement('div');d.className='snip-item'+(p.id===pgCurrentId?' active':'');d.innerHTML=`<div class="snip-hdr" onclick="pgLoad('${p.id}')"><span class="snip-name">${esc(p.name)}</span><button class="snip-del" onclick="pgDeleteProject('${p.id}',event)">‚úï</button></div><div class="snip-tags"><span class="stag stag-html">HTML</span>${hasCss?'<span class="stag stag-css">CSS</span>':''}${hasJs?'<span class="stag stag-js">JS</span>':''}</div>`;list.appendChild(d);});}
function pgDownload(){const pcEd=document.getElementById('pcEditor');if(pcEd)pgContents[pgCurrentLang]=pcEd.value;const proj=pgProjects.find(p=>p.id===pgCurrentId);const name=(proj?.name||'project').replace(/[^a-z0-9_-]/gi,'_');[[pgContents.html,name+'.html','text/html'],[pgContents.css,name+'.css','text/css'],[pgContents.js,name+'.js','application/javascript']].forEach(([content,fn,type])=>{if(!content.trim())return;const b=new Blob([content],{type});const a=document.createElement('a');a.href=URL.createObjectURL(b);a.download=fn;a.click();URL.revokeObjectURL(a.href);});toast('‚¨á Downloaded project files');}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê BUILDER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function blUid(){return 'bl_'+Date.now()+'_'+Math.random().toString(36).substr(2,5);}

function blAddItem(type){
  const def=COMP_DEFS[type];if(!def)return;
  const item={id:blUid(),type,props:{...def.def}};
  blItems.push(item);
  blSelectedId=item.id;
  blRefreshCanvas();
  blRenderProps();
  blUpdateCode();
  blUpdateItemCount();
  toast('Ôºã '+def.label+' added');
  if(IS_MOBILE)blMTab('canvas',document.getElementById('blmt-canvas'));
}

function blRenderCanvasDoc(){
  const body=blItems.map(item=>{
    const def=COMP_DEFS[item.type];if(!def)return '';
    const html=def.render(item.props);
    return `<div class="jkz-canvas-item${item.id===blSelectedId?' sel':''}" data-id="${item.id}" onclick="blSelectItem('${item.id}')">
      <div class="jkz-ctrl">
        <button class="jkz-ctrl-btn" onclick="blMoveItem('${item.id}',-1,event)">‚Üë</button>
        <button class="jkz-ctrl-btn" onclick="blMoveItem('${item.id}',1,event)">‚Üì</button>
        <button class="jkz-ctrl-btn" onclick="blDuplicateItem('${item.id}',event)">‚äï</button>
        <button class="jkz-ctrl-btn del" onclick="blDeleteItem('${item.id}',event)">‚úï</button>
      </div>
      ${html}
    </div>`;
  }).join('');
  return `<!DOCTYPE html><html><head><meta charset="UTF-8"><style>${JKZ_CSS}</style></head><body style="padding:16px;background:#f8fafc;min-height:100vh">${body||'<div style="text-align:center;padding:80px 20px;color:#94a3b8;font-family:sans-serif"><div style="font-size:48px;margin-bottom:16px">üé®</div><div style="font-size:16px">Click a component to add it</div></div>'}<script>
document.querySelectorAll('.jkz-canvas-item').forEach(el=>{
  el.addEventListener('click',function(e){
    if(e.target.closest('.jkz-ctrl')) return;
    window.parent.postMessage({source:'blSelect',id:this.dataset.id},'*');
  });
});
document.querySelectorAll('.jkz-ctrl-btn').forEach(btn=>{
  btn.addEventListener('click',function(e){
    e.stopPropagation();
    const action=this.textContent.trim();
    const item=this.closest('.jkz-canvas-item');
    const id=item?item.dataset.id:'';
    if(action==='‚úï')window.parent.postMessage({source:'blDelete',id},'*');
    else if(action==='‚Üë')window.parent.postMessage({source:'blMove',id,dir:-1},'*');
    else if(action==='‚Üì')window.parent.postMessage({source:'blMove',id,dir:1},'*');
    else if(action==='‚äï')window.parent.postMessage({source:'blDup',id},'*');
  });
});
<\/script></body></html>`;
}

window.addEventListener('message',function(e){
  if(!e.data||!e.data.source)return;
  if(e.data.source==='blSelect'){blSelectedId=e.data.id;blRenderProps();blRefreshCanvas();if(IS_MOBILE)blMTab('props',document.getElementById('blmt-props'));}
  else if(e.data.source==='blDelete'){blItems=blItems.filter(i=>i.id!==e.data.id);if(blSelectedId===e.data.id)blSelectedId=null;blRefreshCanvas();blRenderProps();blUpdateCode();blUpdateItemCount();}
  else if(e.data.source==='blMove'){blMoveItemById(e.data.id,e.data.dir);}
  else if(e.data.source==='blDup'){blDupItemById(e.data.id);}
  else if(e.data.source==='jamkz-console'){const pcFrame=document.getElementById('pcFrame'),mFrame=document.getElementById('mFrame');const src=(e.source===pcFrame?.contentWindow)?'pc':'m';addConsoleLog(src,e.data.level,e.data.args);}
});

function blRefreshCanvas(){
  const doc=blRenderCanvasDoc();
  const pcF=document.getElementById('blFrame');if(pcF)pcF.srcdoc=doc;
  const mF=document.getElementById('blMFrame');if(mF)mF.srcdoc=doc;
  const empty=document.getElementById('blEmptyState');if(empty)empty.classList.toggle('hidden',blItems.length>0);
}

function blSelectItem(id){blSelectedId=id;blRenderProps();blRefreshCanvas();}

function blMoveItem(id,dir,e){if(e)e.stopPropagation();blMoveItemById(id,dir);}
function blMoveItemById(id,dir){const idx=blItems.findIndex(i=>i.id===id);if(idx<0)return;const ni=idx+dir;if(ni<0||ni>=blItems.length)return;[blItems[idx],blItems[ni]]=[blItems[ni],blItems[idx]];blRefreshCanvas();blUpdateCode();}

function blDeleteItem(id,e){if(e)e.stopPropagation();blItems=blItems.filter(i=>i.id!==id);if(blSelectedId===id)blSelectedId=null;blRefreshCanvas();blRenderProps();blUpdateCode();blUpdateItemCount();}

function blDuplicateItem(id,e){if(e)e.stopPropagation();blDupItemById(id);}
function blDupItemById(id){const item=blItems.find(i=>i.id===id);if(!item)return;const copy={...item,id:blUid(),props:{...item.props}};const idx=blItems.findIndex(i=>i.id===id);blItems.splice(idx+1,0,copy);blSelectedId=copy.id;blRefreshCanvas();blRenderProps();blUpdateCode();blUpdateItemCount();}

function blMoveSelected(dir){if(!blSelectedId)return;blMoveItemById(blSelectedId,dir);}
function blDuplicateSelected(){if(!blSelectedId)return;blDupItemById(blSelectedId);}
function blDeleteSelected(){if(!blSelectedId)return;blDeleteItem(blSelectedId);}

function blUpdateItemCount(){const el=document.getElementById('blItemCount');if(el)el.textContent=blItems.length+' component'+(blItems.length!==1?'s':'');}

function blRenderProps(){
  const item=blItems.find(i=>i.id===blSelectedId);
  // PC
  const propsEmpty=document.getElementById('blPropsEmpty'),propsScroll=document.getElementById('blPropsScroll'),propsFoot=document.getElementById('blPropsFoot'),propsName=document.getElementById('blPropsName');
  if(propsEmpty&&propsScroll&&propsFoot){propsEmpty.classList.toggle('hidden',!!item);propsScroll.classList.toggle('hidden',!item);propsFoot.classList.toggle('hidden',!item);}
  if(propsName)propsName.textContent=item?COMP_DEFS[item.type]?.label||item.type:'‚Äî';
  if(propsScroll&&item)propsScroll.innerHTML=buildPropsHTML(item,'pc');
  // Mobile
  const mPropsEmpty=document.getElementById('blMPropsEmpty'),mPropsWrap=document.getElementById('blMPropsWrap'),mPropsName=document.getElementById('blMPropsName'),mPropsScroll=document.getElementById('blMPropsScroll');
  if(mPropsEmpty&&mPropsWrap){mPropsEmpty.classList.toggle('hidden',!!item);mPropsWrap.classList.toggle('hidden',!item);if(item)mPropsWrap.classList.remove('hidden');}
  if(mPropsName)mPropsName.textContent=item?COMP_DEFS[item.type]?.label||item.type:'';
  if(mPropsScroll&&item)mPropsScroll.innerHTML=buildPropsHTML(item,'m');
}

function buildPropsHTML(item,pfx){
  const def=COMP_DEFS[item.type];if(!def)return '';
  return def.props.map(prop=>{
    const val=item.props[prop.k];
    const inputId=`${pfx}_prop_${item.id}_${prop.k}`;
    let ctrl='';
    if(prop.t==='text')ctrl=`<input class="bl-prop-input" id="${inputId}" value="${escHtml(String(val||''))}" oninput="blSetProp('${item.id}','${prop.k}',this.value)">`;
    else if(prop.t==='ta')ctrl=`<textarea class="bl-prop-input" id="${inputId}" rows="3" style="resize:vertical" oninput="blSetProp('${item.id}','${prop.k}',this.value)">${escHtml(String(val||''))}</textarea>`;
    else if(prop.t==='num')ctrl=`<input type="number" class="bl-prop-input" id="${inputId}" value="${val||0}" min="${prop.min||0}" max="${prop.max||9999}" oninput="blSetProp('${item.id}','${prop.k}',Number(this.value))">`;
    else if(prop.t==='sel')ctrl=`<select class="bl-prop-sel" id="${inputId}" onchange="blSetProp('${item.id}','${prop.k}',this.value)">${(prop.o||[]).map(o=>`<option value="${o}"${o===val?' selected':''}>${o}</option>`).join('')}</select>`;
    else if(prop.t==='bool')ctrl=`<label class="bl-prop-tog${val?' checked':''}" id="${inputId}" onclick="blToggleProp('${item.id}','${prop.k}',this)"><div class="tknob"><div class="tknob"></div></div><span>${val?'Yes':'No'}</span></label>`;
    else if(prop.t==='color')ctrl=`<div class="bl-prop-color"><input type="color" value="${val||'#7c6fff'}" oninput="blSetProp('${item.id}','${prop.k}',this.value);document.getElementById('${inputId}').value=this.value"><input class="bl-prop-input" id="${inputId}" value="${val||'#7c6fff'}" oninput="blSetProp('${item.id}','${prop.k}',this.value)"></div>`;
    return `<div class="bl-prop-group"><div class="bl-prop-label">${prop.l}</div>${ctrl}</div>`;
  }).join('');
}

function blSetProp(id,key,val){
  const item=blItems.find(i=>i.id===id);if(!item)return;
  item.props[key]=val;
  blRefreshCanvas();blUpdateCode();
}

function blToggleProp(id,key,el){
  const item=blItems.find(i=>i.id===id);if(!item)return;
  item.props[key]=!item.props[key];
  el.classList.toggle('checked',item.props[key]);
  el.querySelector('span').textContent=item.props[key]?'Yes':'No';
  blRefreshCanvas();blUpdateCode();
}

function blUpdateCode(){
  const html=blGenerateCleanHTML();
  const pcEl=document.getElementById('blCodeOut');if(pcEl)pcEl.textContent=html;
  const mEl=document.getElementById('blMCodeOut');if(mEl)mEl.textContent=html;
}

function blGenerateCleanHTML(){
  if(!blItems.length)return '<!-- No components added yet -->';
  const parts=blItems.map(item=>{const def=COMP_DEFS[item.type];if(!def)return '';return `<!-- ${def.label} -->\n${def.render(item.props)}`;});
  return `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Design</title>
  <style>
    /* Jam by Kz ‚Äî UI Designer Export */
    ${JKZ_CSS.replace(/\s+/g,' ')}
  </style>
</head>
<body>
  <div class="jkz-wrap">
    ${parts.join('\n\n    ')}
  </div>
</body>
</html>`;
}

function blClearCanvas(){if(blItems.length&&!confirm('Clear all components?'))return;blItems=[];blSelectedId=null;blRefreshCanvas();blRenderProps();blUpdateCode();blUpdateItemCount();toast('Canvas cleared');}

function blCopyCode(){copyText(blGenerateCleanHTML());toast('‚úì HTML code copied!');}

function blDownload(){const html=blGenerateCleanHTML();const b=new Blob([html],{type:'text/html'});const a=document.createElement('a');a.href=URL.createObjectURL(b);a.download='my-design.html';a.click();URL.revokeObjectURL(a.href);toast('‚¨á Exported my-design.html');}

function blToggleCode(){blCodeOpen=!blCodeOpen;document.getElementById('blCodePanel').classList.toggle('open',blCodeOpen);document.getElementById('blCodeToggle').style.color=blCodeOpen?'var(--acc2)':'';if(blCodeOpen)blUpdateCode();}

function blRenderPalette(){
  const scroll=document.getElementById('blPalScroll');if(!scroll)return;
  const cats={};Object.entries(COMP_DEFS).forEach(([type,def])=>{if(!cats[def.cat])cats[def.cat]=[];cats[def.cat].push({type,...def});});
  scroll.innerHTML=Object.entries(cats).map(([cat,comps])=>`<div class="bl-cat-lbl">${cat}</div>${comps.map(c=>`<button class="bl-comp-btn" onclick="blAddItem('${c.type}')"><span class="bl-comp-icon">${c.icon}</span>${c.label}</button>`).join('')}`).join('');
}

function blFilterComps(q){
  const scroll=document.getElementById('blPalScroll');if(!scroll)return;
  const lower=q.toLowerCase();const cats={};
  Object.entries(COMP_DEFS).forEach(([type,def])=>{if(!q||def.label.toLowerCase().includes(lower)||def.cat.toLowerCase().includes(lower)){if(!cats[def.cat])cats[def.cat]=[];cats[def.cat].push({type,...def});}});
  scroll.innerHTML=Object.entries(cats).map(([cat,comps])=>`<div class="bl-cat-lbl">${cat}</div>${comps.map(c=>`<button class="bl-comp-btn" onclick="blAddItem('${c.type}')"><span class="bl-comp-icon">${c.icon}</span>${c.label}</button>`).join('')}`).join('');
  if(!scroll.innerHTML)scroll.innerHTML='<div style="padding:20px;text-align:center;color:var(--text3);font-size:12px">No components found</div>';
}

function blRenderMPalette(){
  const scroll=document.getElementById('blMPalScroll');if(!scroll)return;
  const cats={};Object.entries(COMP_DEFS).forEach(([type,def])=>{if(!cats[def.cat])cats[def.cat]=[];cats[def.cat].push({type,...def});});
  scroll.innerHTML=Object.entries(cats).map(([cat,comps])=>`
    <div class="bl-m-cat-lbl">${cat}</div>
    <div class="bl-m-grid">${comps.map(c=>`<button class="bl-m-comp-btn" onclick="blAddItem('${c.type}')"><div class="bl-m-icon">${c.icon}</div><span>${c.label}</span></button>`).join('')}</div>
  `).join('');
}

function blMTab(tab,btn){
  document.querySelectorAll('.bl-m-tab').forEach(b=>b.classList.remove('active'));
  if(btn)btn.classList.add('active');
  ['add','canvas','props','code'].forEach(t=>{const el=document.getElementById('blm-'+t);if(el)el.classList.toggle('hidden',t!==tab);});
  if(tab==='code')blUpdateCode();
  if(tab==='canvas'){blRefreshCanvas();}
}

// RESIZE HANDLE (PC)
(function(){
  const handle=document.getElementById('resizeH'),container=document.getElementById('pgMain');
  const ep=document.getElementById('edPane'),pp=document.getElementById('pvPane');
  let drag=false,startX=0,startW=0;
  if(!handle)return;
  handle.addEventListener('mousedown',function(e){if(pgLayMode!=='split')return;drag=true;startX=e.clientX;startW=ep.getBoundingClientRect().width;document.body.style.cursor='col-resize';document.body.style.userSelect='none';});
  document.addEventListener('mousemove',function(e){if(!drag)return;const cw=container.getBoundingClientRect().width;const nw=Math.max(200,Math.min(cw-200,startW+(e.clientX-startX)));ep.style.width=nw+'px';ep.style.flex='none';pp.style.width=(cw-nw-4)+'px';pp.style.flex='none';});
  document.addEventListener('mouseup',function(){if(drag){drag=false;document.body.style.cursor='';document.body.style.userSelect='';}});
})();

// INIT
window.onload=function(){
  apexRenderList();apexNew();
  pgRenderList();pgNew();
  blRenderPalette();
  blRenderMPalette();
  blRefreshCanvas();
};
</script>
